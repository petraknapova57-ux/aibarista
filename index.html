<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BaristaAI ‚Äî Receptury & Kalkulace</title>
<meta name="theme-color" content="#2c1a0e">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="BaristaAI">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Lato:ital,wght@0,300;0,400;0,700;1,400&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root{
  /* Core palette */
  --red:     #c0392b;   /* main accent ‚Äî warm deep red */
  --red-soft:#e8504a;   /* hover / lighter red */
  --red-pale:#fdf0ef;   /* red tint backgrounds */
  --espresso:#2c1a0e;   /* darkest brown ‚Äî headings */
  --roast:   #5c3520;   /* medium brown */
  --latte:   #c4a882;   /* warm tan */
  --cream:   #faf6f0;   /* warm white */
  --sage:    #6a9e7a;   /* success / kids */

  --bg:      #f7f2eb;
  --surface: #fffcf8;
  --text:    #2c1a0e;
  --muted:   #8a7060;
  --border:  rgba(196,168,130,.25);
  --shadow:  0 2px 20px rgba(44,26,14,.08);
}

*{margin:0;padding:0;box-sizing:border-box;}

body{
  font-family:'Lato',sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  overflow-x:hidden;
}

/* Warm layered background */
body::before{
  content:'';position:fixed;inset:0;z-index:-2;
  background:
    radial-gradient(ellipse at 100% 0%,   rgba(192,57,43,.07)  0%, transparent 45%),
    radial-gradient(ellipse at 0%   100%, rgba(196,168,130,.12) 0%, transparent 50%),
    radial-gradient(ellipse at 50%  50%,  rgba(250,246,240,.9)  0%, transparent 70%),
    #f7f2eb;
}
/* Subtle dot texture */
body::after{
  content:'';position:fixed;inset:0;z-index:-1;
  background-image:url("data:image/svg+xml,%3Csvg width='32' height='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='16' cy='16' r='.8' fill='%23c4a882' fill-opacity='0.15'/%3E%3C/svg%3E");
}

/* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
header{
  padding:0;
  display:flex;align-items:stretch;
  background:var(--espresso);
  position:sticky;top:0;z-index:100;
  animation:fadeDown .7s ease;
  box-shadow:0 2px 12px rgba(44,26,14,.25);
}
.header-inner{
  display:flex;align-items:center;justify-content:space-between;
  width:100%;max-width:1100px;margin:0 auto;padding:1.1rem 2rem;
}
.logo{
  font-family:'Playfair Display',serif;
  font-size:1.7rem;font-weight:700;
  color:var(--cream);
  letter-spacing:-.2px;
}
.logo span{ color:var(--red-soft); font-style:italic; }
.tagline{
  font-family:'Lato',sans-serif;font-size:.65rem;
  color:rgba(250,246,240,.45);letter-spacing:2px;text-transform:uppercase;
}

/* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
main{max-width:1100px;margin:0 auto;padding:3rem 2rem;}

/* ‚îÄ‚îÄ Hero ‚îÄ‚îÄ */
.hero{text-align:center;margin-bottom:3rem;animation:fadeUp 1s ease .2s both;}
.hero h1{
  font-family:'Playfair Display',serif;font-weight:700;
  font-size:clamp(2.2rem,5vw,3.6rem);
  color:var(--espresso);line-height:1.18;margin-bottom:1rem;
}
.hero h1 em{ color:var(--red); font-style:italic; }
.hero p{color:var(--muted);font-size:1rem;max-width:520px;margin:0 auto;line-height:1.75;}

/* ‚îÄ‚îÄ Red accent strip on form card top ‚îÄ‚îÄ */
.input-card{
  background:var(--surface);
  border-radius:16px;padding:2.5rem;
  border:1px solid var(--border);
  box-shadow:var(--shadow);
  border-top:3px solid var(--red);
  animation:fadeUp 1s ease .4s both;margin-bottom:2rem;
}
.input-card h2{
  font-family:'Playfair Display',serif;font-size:1.35rem;font-weight:600;
  color:var(--espresso);margin-bottom:1.5rem;
}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.25rem;margin-bottom:1.5rem;}
.form-group{display:flex;flex-direction:column;gap:.4rem;}
.form-group.full{grid-column:1/-1;}
label{
  font-family:'Lato',sans-serif;font-size:.67rem;font-weight:700;
  letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);
}
input,select,textarea{
  font-family:'Lato',sans-serif;font-size:.93rem;
  padding:.72rem 1rem;
  border:1px solid rgba(196,168,130,.3);
  border-radius:8px;background:#fffcf8;
  color:var(--text);transition:all .18s;outline:none;
}
input:focus,select:focus,textarea:focus{
  border-color:var(--red);background:#fff;
  box-shadow:0 0 0 3px rgba(192,57,43,.1);
}
textarea{resize:vertical;min-height:88px;line-height:1.6;}

/* ‚îÄ‚îÄ Tag groups ‚îÄ‚îÄ */
.tag-group{margin-bottom:.9rem;}
.tag-group-label{
  font-family:'Lato',sans-serif;font-size:.62rem;font-weight:700;
  letter-spacing:1.8px;text-transform:uppercase;color:var(--muted);
  margin-bottom:.5rem;display:flex;align-items:center;gap:.5rem;
}
.tag-group-label::after{content:'';flex:1;height:1px;background:var(--border);}
.tags-row{display:flex;flex-wrap:wrap;gap:.4rem;}

.tag-btn{
  font-family:'Lato',sans-serif;font-size:.75rem;font-weight:600;
  padding:.32rem .85rem;border-radius:20px;
  border:1px solid rgba(196,168,130,.35);
  background:#fffcf8;color:var(--muted);
  cursor:pointer;transition:all .18s;
}
.tag-btn:hover{ border-color:var(--red);color:var(--red);background:var(--red-pale);}
.tag-btn.active{ background:var(--red);border-color:var(--red);color:#fff;}

/* Alcohol ‚Äî dark roast */
.tag-btn.alc{ border-color:rgba(92,53,32,.3);color:var(--roast);}
.tag-btn.alc:hover{ background:rgba(92,53,32,.07);border-color:var(--roast);color:var(--espresso);}
.tag-btn.alc.active{ background:var(--roast);border-color:var(--roast);color:#fff;}

/* Kids ‚Äî sage */
.tag-btn.kid{ border-color:rgba(106,158,122,.35);color:#3a7050;}
.tag-btn.kid:hover{ background:rgba(106,158,122,.1);border-color:var(--sage);}
.tag-btn.kid.active{ background:var(--sage);border-color:var(--sage);color:#fff;}

/* ‚îÄ‚îÄ Generate button ‚îÄ‚îÄ */
.generate-btn{
  width:100%;padding:.95rem 2rem;
  background:var(--red);
  color:#fff;border:none;border-radius:10px;
  font-family:'Lato',sans-serif;font-size:.95rem;font-weight:700;letter-spacing:.5px;
  cursor:pointer;transition:all .25s;
  display:flex;align-items:center;justify-content:center;gap:.6rem;
  margin-top:1.25rem;
  box-shadow:0 4px 16px rgba(192,57,43,.3);
}
.generate-btn:hover{background:var(--red-soft);transform:translateY(-1px);box-shadow:0 6px 22px rgba(192,57,43,.38);}
.generate-btn:active{transform:translateY(0);}

/* ‚îÄ‚îÄ Loading ‚îÄ‚îÄ */
.loading-section{display:none;text-align:center;padding:4rem;}
.bubbles{display:flex;justify-content:center;gap:10px;margin-bottom:1.5rem;}
.bubble{width:11px;height:11px;border-radius:50%;animation:bounce 1.3s ease-in-out infinite;}
.bubble:nth-child(1){background:var(--red);      animation-delay:0s;}
.bubble:nth-child(2){background:var(--latte);    animation-delay:.15s;}
.bubble:nth-child(3){background:var(--red-soft); animation-delay:.3s;}
.bubble:nth-child(4){background:var(--roast);    animation-delay:.45s;}
.bubble:nth-child(5){background:var(--red);      animation-delay:.6s;}
.bubble:nth-child(6){background:var(--latte);    animation-delay:.75s;}
@keyframes bounce{0%,80%,100%{transform:translateY(0);opacity:.4}40%{transform:translateY(-14px);opacity:1}}
.loading-text{font-family:'Playfair Display',serif;font-size:1.25rem;font-style:italic;color:var(--espresso);}
.loading-sub{font-size:.68rem;color:var(--muted);letter-spacing:1.5px;text-transform:uppercase;margin-top:.5rem;}

/* ‚îÄ‚îÄ Result ‚îÄ‚îÄ */
.result-section{display:none;animation:fadeUp .7s ease;}
.drink-hero{margin-bottom:2rem;}
.drink-title{font-family:'Playfair Display',serif;font-weight:700;font-size:clamp(2rem,4vw,3rem);color:var(--espresso);line-height:1.1;}
.drink-subtitle{color:var(--muted);font-size:.93rem;margin-top:.5rem;line-height:1.7;}
.drink-badge{
  display:inline-block;background:var(--red);
  color:#fff;padding:.35rem 1rem;border-radius:4px;
  font-family:'Lato',sans-serif;font-size:.65rem;font-weight:700;
  letter-spacing:1.8px;text-transform:uppercase;margin-top:.75rem;
}

/* ‚îÄ‚îÄ Cards ‚îÄ‚îÄ */
.cards-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:1.5rem;}
.info-card{
  background:var(--surface);border-radius:14px;padding:1.75rem;
  border:1px solid var(--border);box-shadow:var(--shadow);
}
.info-card.full{grid-column:1/-1;}
.info-card.highlight{border-top:3px solid var(--sage);background:linear-gradient(160deg,#fffcf8,#f4faf6);}
.card-label{
  font-family:'Lato',sans-serif;font-size:.66rem;font-weight:700;
  letter-spacing:2px;text-transform:uppercase;color:var(--muted);
  margin-bottom:1rem;display:flex;align-items:center;gap:.5rem;
}
.card-label::after{content:'';flex:1;height:1px;background:var(--border);}

/* ‚îÄ‚îÄ Steps ‚îÄ‚îÄ */
.step-list{list-style:none;}
.step-item{display:flex;gap:1rem;padding:.72rem 0;border-bottom:1px solid var(--border);animation:slideIn .4s ease both;}
.step-item:last-child{border-bottom:none;}
.step-num{
  width:26px;height:26px;flex-shrink:0;margin-top:.15rem;
  border-radius:50%;display:flex;align-items:center;justify-content:center;
  font-family:'Lato',sans-serif;font-size:.7rem;font-weight:700;
}
.step-num.c0,.step-num.c2,.step-num.c4{background:var(--red);color:#fff;}
.step-num.c1,.step-num.c3,.step-num.c5{background:var(--espresso);color:var(--cream);}
.step-text{font-size:.92rem;line-height:1.65;color:var(--text);}

/* ‚îÄ‚îÄ Editable ingredients ‚îÄ‚îÄ */
.ing-table{width:100%;border-collapse:collapse;margin-bottom:.5rem;}
.ing-table th{font-family:'Lato',sans-serif;font-size:.62rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);padding:.45rem .5rem;border-bottom:2px solid var(--border);text-align:left;}
.ing-table th.r{text-align:right;}
.ing-table td{padding:.3rem .4rem;border-bottom:1px solid rgba(196,168,130,.12);vertical-align:middle;}
.ing-table tr:last-child td{border-bottom:none;}
.ing-input{font-family:'Lato',sans-serif;font-size:.88rem;padding:.3rem .5rem;border:1px solid transparent;border-radius:6px;background:transparent;color:var(--text);width:100%;transition:all .18s;outline:none;}
.ing-input:hover{border-color:rgba(196,168,130,.3);background:rgba(200,168,130,.05);}
.ing-input:focus{border-color:var(--red);background:#fff;box-shadow:0 0 0 2px rgba(192,57,43,.09);}
.ing-input.amt{font-family:'DM Mono',monospace;font-size:.82rem;color:var(--roast);text-align:right;}
.ing-input.cst{font-family:'DM Mono',monospace;font-size:.82rem;color:var(--roast);text-align:right;width:68px;}
.del-btn{width:24px;height:24px;border:none;background:rgba(192,57,43,.1);color:var(--red);border-radius:6px;cursor:pointer;font-size:.95rem;line-height:1;display:flex;align-items:center;justify-content:center;transition:all .15s;}
.del-btn:hover{background:var(--red);color:#fff;}
.add-btn{margin-top:.65rem;width:100%;padding:.5rem;background:transparent;border:1px dashed rgba(196,168,130,.4);border-radius:8px;color:var(--muted);font-family:'Lato',sans-serif;font-size:.76rem;font-weight:600;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:.4rem;}
.add-btn:hover{border-color:var(--red);color:var(--red);background:var(--red-pale);}

/* ‚îÄ‚îÄ Cost summary ‚îÄ‚îÄ */
.cost-sep{height:1px;background:var(--border);margin:.65rem 0;}
.cost-line{display:flex;justify-content:space-between;align-items:center;padding:.45rem .5rem;border-radius:7px;}
.cost-line.sub{background:rgba(196,168,130,.09);}
.cost-line.tot{background:var(--red-pale);border:1px solid rgba(192,57,43,.18);margin-top:.35rem;}
.cost-lbl{font-family:'Lato',sans-serif;font-size:.67rem;font-weight:700;letter-spacing:1.2px;text-transform:uppercase;color:var(--muted);}
.cost-val{font-family:'Playfair Display',serif;font-size:1.25rem;color:var(--espresso);font-weight:700;}
.cost-val.sm{font-family:'DM Mono',monospace;font-size:.86rem;font-weight:400;color:var(--roast);}
.labor-note{margin-top:.9rem;padding-top:.85rem;border-top:1px dashed var(--border);font-size:.77rem;color:var(--muted);line-height:1.65;}
.labor-note strong{color:var(--text);}
.labor-tags{display:flex;flex-wrap:wrap;gap:.4rem;margin-top:.55rem;}
.labor-tag{background:rgba(196,168,130,.1);border:1px solid var(--border);border-radius:5px;padding:.2rem .55rem;font-family:'Lato',sans-serif;font-size:.63rem;color:var(--muted);}
.src-note{font-size:.6rem;color:rgba(138,112,96,.45);margin-top:.7rem;line-height:1.5;}

/* ‚îÄ‚îÄ Pricing card ‚îÄ‚îÄ */
.price-row{display:flex;justify-content:space-between;align-items:center;padding:.7rem 0;border-bottom:1px solid var(--border);}
.price-row:last-child{border-bottom:none;}
.price-lbl{font-size:.9rem;color:var(--text);}
.price-val{font-family:'DM Mono',monospace;font-size:.92rem;color:var(--roast);font-weight:500;}
.price-val.big{font-family:'Playfair Display',serif;font-size:1.65rem;color:var(--sage);font-weight:700;}
.m-dual{display:flex;gap:.6rem;align-items:center;}
.m-czk{font-family:'DM Mono',monospace;font-size:.92rem;color:var(--roast);}
.m-pct{font-family:'Lato',sans-serif;font-size:.75rem;color:var(--muted);background:rgba(196,168,130,.14);padding:.15rem .5rem;border-radius:5px;}
.m-bar{background:rgba(196,168,130,.18);border-radius:100px;height:6px;margin-top:.8rem;overflow:hidden;}
.m-fill{height:100%;background:linear-gradient(90deg,var(--red),var(--latte));border-radius:100px;transition:width .55s ease;width:0%;}
.m-scale{display:flex;justify-content:space-between;margin-top:.3rem;font-size:.6rem;color:rgba(138,112,96,.45);}
.slider-box{margin-top:1.1rem;padding:1rem;border:1px solid var(--border);border-radius:10px;background:rgba(196,168,130,.04);}
.slider-hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:.7rem;}
.slider-lbl{font-family:'Lato',sans-serif;font-size:.64rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);}
.slider-val{font-family:'DM Mono',monospace;font-size:.9rem;color:var(--red);font-weight:500;}
input[type=range]{-webkit-appearance:none;appearance:none;width:100%;height:5px;background:linear-gradient(90deg,var(--red) var(--p,70%),rgba(196,168,130,.22) var(--p,70%));border-radius:100px;cursor:pointer;outline:none;border:none;padding:0;}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;background:var(--red);border-radius:50%;cursor:pointer;box-shadow:0 2px 8px rgba(192,57,43,.3);transition:transform .15s;border:2px solid #fff;}
input[type=range]::-webkit-slider-thumb:hover{transform:scale(1.15);}
input[type=range]::-moz-range-thumb{width:20px;height:20px;border:2px solid #fff;background:var(--red);border-radius:50%;}
.slider-scale{display:flex;justify-content:space-between;margin-top:.32rem;font-size:.6rem;color:rgba(138,112,96,.4);}
.slider-result{margin-top:.8rem;background:rgba(106,158,122,.07);border:1px solid rgba(106,158,122,.25);border-radius:9px;padding:.8rem 1rem;display:flex;justify-content:space-between;align-items:center;}
.slider-result-lbl{font-size:.88rem;color:var(--text);}
.slider-result-price{font-family:'Playfair Display',serif;font-size:1.35rem;color:var(--sage);font-weight:700;}

/* ‚îÄ‚îÄ Market ‚îÄ‚îÄ */
.market-card{background:var(--espresso);border:none;border-radius:14px;padding:1.75rem;}
.market-lbl{font-family:'Lato',sans-serif;font-size:.66rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:rgba(250,246,240,.5);margin-bottom:1rem;display:flex;align-items:center;gap:.5rem;}
.market-lbl::after{content:'';flex:1;height:1px;background:rgba(250,246,240,.12);}
.market-item{padding:.85rem 0;border-bottom:1px solid rgba(250,246,240,.08);animation:slideIn .4s ease both;}
.market-item:last-child{border-bottom:none;}
.market-name{font-size:.93rem;color:var(--cream);font-weight:600;}
.market-meta{display:flex;justify-content:space-between;align-items:center;margin-top:.28rem;}
.market-loc{font-size:.77rem;color:rgba(250,246,240,.4);}
.market-price{font-family:'DM Mono',monospace;font-size:.86rem;color:var(--red-soft);font-weight:700;}
.market-note{font-size:.76rem;color:rgba(250,246,240,.35);margin-top:.22rem;font-style:italic;}
.market-insight{margin-top:.9rem;padding:.8rem 1rem;background:rgba(255,255,255,.05);border-radius:9px;border:1px solid rgba(250,246,240,.1);}
.market-insight-lbl{font-family:'Lato',sans-serif;font-size:.61rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:rgba(250,246,240,.4);margin-bottom:.38rem;}
.market-insight-txt{font-size:.84rem;color:rgba(250,246,240,.65);line-height:1.65;}
.market-none{text-align:center;padding:1rem 0;color:rgba(250,246,240,.4);font-size:.9rem;font-style:italic;}
.market-disc{margin-top:.9rem;font-size:.6rem;color:rgba(250,246,240,.25);line-height:1.55;}

/* ‚îÄ‚îÄ Error banner ‚îÄ‚îÄ */
.error-banner{background:var(--red-pale);border:1px solid rgba(192,57,43,.3);border-radius:10px;padding:1rem 1.25rem;margin-bottom:1.5rem;font-size:.87rem;color:var(--red);display:none;animation:fadeUp .4s ease;}

/* ‚îÄ‚îÄ Reset button ‚îÄ‚îÄ */
.reset-btn{margin:2rem auto 0;display:block;padding:.7rem 2rem;background:transparent;border:1px solid rgba(196,168,130,.4);border-radius:8px;color:var(--muted);font-family:'Lato',sans-serif;font-size:.74rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;cursor:pointer;transition:all .2s;}
.reset-btn:hover{border-color:var(--red);color:var(--red);background:var(--red-pale);}

/* ‚îÄ‚îÄ Floating coffee beans ‚îÄ‚îÄ */
.beans{position:fixed;top:0;left:0;width:100%;height:100vh;pointer-events:none;z-index:-1;overflow:hidden;}
.bean{position:absolute;line-height:0;}

@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeDown{from{opacity:0;transform:translateY(-12px)}to{opacity:1;transform:translateY(0)}}
@keyframes slideIn{from{opacity:0;transform:translateX(-8px)}to{opacity:1;transform:translateX(0)}}
/* floatUp replaced by beanFloat0/1 */

@media(max-width:780px){
  header{padding:0}
  .header-inner{padding:1rem 1.5rem}
  main{padding:2rem 1rem}
  .form-grid,.cards-grid{grid-template-columns:1fr}
  .input-card{padding:1.5rem}
}

/* ‚ïê‚ïê ACCESS GATE ‚ïê‚ïê */
#accessGate{
  position:fixed;inset:0;z-index:9000;
  background:var(--bg);
  display:flex;align-items:center;justify-content:center;
  padding:1.5rem;
}
.gate-box{
  background:var(--surface);
  border-radius:20px;
  padding:3rem 2.5rem;
  border:1px solid var(--border);
  border-top:3px solid var(--red);
  box-shadow:0 8px 40px rgba(44,26,14,.12);
  width:100%;max-width:420px;
  text-align:center;
  animation:fadeUp .6s ease;
}
.gate-logo{
  font-family:'Playfair Display',serif;
  font-size:2rem;font-weight:700;
  color:var(--espresso);margin-bottom:.3rem;
}
.gate-logo span{color:var(--red-soft);font-style:italic;}
.gate-tagline{
  font-size:.68rem;color:var(--muted);
  letter-spacing:2px;text-transform:uppercase;
  margin-bottom:2rem;
}
.gate-title{
  font-family:'Playfair Display',serif;
  font-size:1.25rem;color:var(--espresso);
  margin-bottom:.5rem;
}
.gate-desc{
  font-size:.88rem;color:var(--muted);
  line-height:1.65;margin-bottom:1.75rem;
}
.gate-input-wrap{position:relative;margin-bottom:.9rem;}
.gate-input{
  width:100%;padding:.85rem 1rem;
  font-family:'DM Mono',monospace;font-size:1rem;
  letter-spacing:3px;text-align:center;text-transform:uppercase;
  border:1.5px solid rgba(196,168,130,.4);
  border-radius:10px;background:#fffcf8;
  color:var(--espresso);outline:none;transition:all .2s;
}
.gate-input:focus{border-color:var(--red);box-shadow:0 0 0 3px rgba(192,57,43,.1);}
.gate-input.error{border-color:var(--red);animation:shake .35s ease;}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}
.gate-btn{
  width:100%;padding:.9rem;
  background:var(--red);color:#fff;border:none;border-radius:10px;
  font-family:'Lato',sans-serif;font-size:.95rem;font-weight:700;
  letter-spacing:.5px;cursor:pointer;transition:all .25s;
  box-shadow:0 4px 16px rgba(192,57,43,.28);
}
.gate-btn:hover{background:var(--red-soft);transform:translateY(-1px);}
.gate-btn:active{transform:translateY(0);}
.gate-err{
  font-size:.8rem;color:var(--red);
  min-height:1.2em;margin-top:.5rem;
  font-weight:600;
}
.gate-footer{
  margin-top:1.75rem;padding-top:1.25rem;
  border-top:1px solid var(--border);
  font-size:.78rem;color:var(--muted);
  line-height:1.7;
}
.gate-footer a{color:var(--red);text-decoration:none;font-weight:700;}
.gate-footer a:hover{text-decoration:underline;}

/* ‚ïê‚ïê COOKIE BANNER ‚ïê‚ïê */
#cookieBanner{
  position:fixed;bottom:0;left:0;right:0;z-index:8000;
  background:var(--espresso);color:#e8ddd4;
  padding:1rem 1.5rem;
  display:flex;align-items:center;justify-content:space-between;
  gap:1rem;flex-wrap:wrap;
  box-shadow:0 -4px 24px rgba(44,26,14,.18);
  transform:translateY(100%);transition:transform .35s ease;
}
#cookieBanner.show{transform:translateY(0)}
.cookie-text{font-size:.83rem;line-height:1.55;flex:1;min-width:200px}
.cookie-text a{color:var(--latte);text-decoration:underline;cursor:pointer}
.cookie-btns{display:flex;gap:.6rem;flex-shrink:0}
.cookie-btn{
  padding:.5rem 1.1rem;border-radius:7px;border:none;
  font-family:'Lato',sans-serif;font-size:.83rem;font-weight:700;cursor:pointer;
  transition:background .2s;
}
.cookie-btn-accept{background:var(--red);color:#fff}
.cookie-btn-accept:hover{background:var(--red-soft)}
.cookie-btn-info{background:transparent;color:var(--latte);border:1.5px solid rgba(196,168,130,.4)}
.cookie-btn-info:hover{background:rgba(196,168,130,.1)}

/* ‚ïê‚ïê PRIVACY MODAL ‚ïê‚ïê */
#privacyModal{
  position:fixed;inset:0;z-index:9500;
  background:rgba(44,26,14,.6);backdrop-filter:blur(3px);
  display:none;align-items:center;justify-content:center;padding:1.5rem;
}
#privacyModal.open{display:flex}
.privacy-box{
  background:var(--surface);border-radius:16px;
  box-shadow:0 12px 48px rgba(44,26,14,.22);
  width:100%;max-width:640px;max-height:85vh;
  display:flex;flex-direction:column;overflow:hidden;
}
.privacy-header{
  padding:1.25rem 1.5rem;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
}
.privacy-title{font-family:'Playfair Display',serif;font-size:1.15rem;color:var(--espresso)}
.privacy-close{
  background:none;border:none;font-size:1.4rem;cursor:pointer;
  color:var(--muted);line-height:1;padding:.2rem .4rem;border-radius:4px;
}
.privacy-close:hover{color:var(--text);background:var(--bg)}
.privacy-body{padding:1.5rem;overflow-y:auto;font-size:.88rem;line-height:1.7;color:var(--text)}
.privacy-body h3{
  font-family:'Playfair Display',serif;font-size:.95rem;
  color:var(--espresso);margin:1.2rem 0 .4rem;
}
.privacy-body h3:first-child{margin-top:0}
.privacy-body p{margin-bottom:.6rem}
.privacy-body a{color:var(--red)}
.privacy-body ul{padding-left:1.2rem;margin-bottom:.6rem}
.privacy-body li{margin-bottom:.25rem}
.privacy-footer{
  padding:1rem 1.5rem;border-top:1px solid var(--border);
  display:flex;justify-content:flex-end;
}

</style>
  <!-- App Icon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3CradialGradient id='bg' cx='50%25' cy='35%25'%3E%3Cstop offset='0%25' stop-color='%23faf6f0'/%3E%3Cstop offset='100%25' stop-color='%23f7f2eb'/%3E%3C/radialGradient%3E%3CradialGradient id='bean' cx='40%25' cy='35%25'%3E%3Cstop offset='0%25' stop-color='%237a4828'/%3E%3Cstop offset='100%25' stop-color='%233b1a08'/%3E%3C/radialGradient%3E%3C/defs%3E%3Crect width='100' height='100' fill='url(%23bg)' rx='18'/%3E%3Cellipse cx='50' cy='55' rx='21' ry='29' fill='url(%23bean)'/%3E%3Cpath d='M50 30 Q45 43 45 55 Q45 67 50 80' stroke='%232c1a0e' stroke-width='2.5' fill='none' stroke-linecap='round' opacity='.6'/%3E%3Ctext x='50' y='22' font-family='serif' font-size='14' font-weight='700' fill='%23c0392b' text-anchor='middle' font-style='italic'%3EAI%3C/text%3E%3C/svg%3E">
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3CradialGradient id='bg' cx='50%25' cy='35%25'%3E%3Cstop offset='0%25' stop-color='%23faf6f0'/%3E%3Cstop offset='100%25' stop-color='%23f7f2eb'/%3E%3C/radialGradient%3E%3CradialGradient id='bean' cx='40%25' cy='35%25'%3E%3Cstop offset='0%25' stop-color='%237a4828'/%3E%3Cstop offset='100%25' stop-color='%233b1a08'/%3E%3C/radialGradient%3E%3C/defs%3E%3Crect width='100' height='100' fill='url(%23bg)' rx='18'/%3E%3Cellipse cx='50' cy='55' rx='21' ry='29' fill='url(%23bean)'/%3E%3Cpath d='M50 30 Q45 43 45 55 Q45 67 50 80' stroke='%232c1a0e' stroke-width='2.5' fill='none' stroke-linecap='round' opacity='.6'/%3E%3Ctext x='50' y='22' font-family='serif' font-size='14' font-weight='700' fill='%23c0392b' text-anchor='middle' font-style='italic'%3EAI%3C/text%3E%3C/svg%3E">
  <meta name="theme-color" content="#c0392b">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="BaristaAI">

</head>
<body>

<!-- ‚ïê‚ïê ACCESS GATE ‚ïê‚ïê -->
<div id="accessGate">
  <div class="gate-box">
    <div class="gate-logo">Barista<span>AI</span></div>
    <div class="gate-tagline">AI pomocn√≠k pro va≈°i kav√°rnu</div>
    <div class="gate-title">Zadejte p≈ô√≠stupov√Ω k√≥d</div>
    <div class="gate-desc" id="gateDesc">
      Testovac√≠ demo verze BaristaAI.<br>
      Zadejte p≈ô√≠stupov√Ω k√≥d pro pokraƒçov√°n√≠.
    </div>
    <div class="gate-input-wrap">
      <input class="gate-input" id="gateCodeInput"
        placeholder="XXXX-XXXX"
        maxlength="9"
        oninput="formatGateCode(this)"
        onkeydown="if(event.key==='Enter')checkAccessCode()">
    </div>
    <button class="gate-btn" onclick="checkAccessCode()">Aktivovat p≈ô√≠stup ‚Üí</button>
    <div class="gate-err" id="gateErr"></div>
    <div class="gate-footer" id="gateFooter">
      Nem√°te je≈°tƒõ k√≥d?
      <a href="mailto:info@example.com" id="gateContactLink">Kontaktujte n√°s</a>
      a z√≠sk√°te testovac√≠ p≈ô√≠stup.<br>
      <span style="font-size:.72rem;opacity:.7" id="gateFooterNote">Demo verze ‚Äî k√≥d plat√≠ 30 dn√≠.</span>
    </div>
  </div>
</div>

<div class="beans" id="beans"></div>
<header>
  <div class="header-inner">
    <div class="logo">Barista<span>AI</span></div>
    <div class="tagline">AI pomocn√≠k pro va≈°i kav√°rnu</div>
  </div>
</header>

<main>
  <section class="hero">
    <h1>Vytvo≈ô <em>recept</em> na k√°vov√Ω n√°poj<br><em>za p√°r minut</em> ‚Äî vƒçetnƒõ n√°klad≈Ø, ceny a mar≈æe.</h1>
    <p>Tv≈Øj AI barista porad√≠ s receptem, n√°klady i prodejn√≠ cenou ‚Äî a zjist√≠, jak to maj√≠ tvoji konkurenti.</p>
  </section>

  <!-- ‚îÄ‚îÄ Form ‚îÄ‚îÄ -->
  <div class="input-card" id="inputSection">
    <h2>Popi≈°te sv≈Øj n√°poj</h2>

    <div class="form-grid">
      <div class="form-group full">
        <label>Up≈ôesnƒõn√≠ <span style="font-weight:400;text-transform:none;letter-spacing:0;font-family:'DM Sans',sans-serif;font-size:.75rem;color:rgba(122,92,58,.55)">(nepovinn√©)</span></label>
        <textarea id="concept" placeholder="Nechte pr√°zdn√© a AI navrhne recept sama ‚Äî nebo up≈ôesnƒõte: 'letn√≠ n√°poj s mangem', 'h≈ôejiv√Ω zimn√≠ drink s ko≈ôen√≠m'..."></textarea>
      </div>
      <div class="form-group">
        <label>Z√°klad n√°poje</label>
        <select id="coffeeBase">
          <option value="espresso">Espresso</option>
          <option value="ristretto">Ristretto</option>
          <option value="lungo">Lungo</option>
          <option value="cold brew">Cold Brew</option>
          <option value="aeropress">AeroPress</option>
          <option value="pour over">Pour Over</option>
          <option value="kids">üßí Varianta pro dƒõti (bez k√°vy)</option>
        </select>
      </div>
      <div class="form-group">
        <label>Typ n√°poje</label>
        <select id="drinkType">
          <option value="hot">Hork√Ω</option>
          <option value="iced">Ledov√Ω</option>
          <option value="blended">Blended / Frapp√©</option>
          <option value="any">AI rozhodne</option>
        </select>
      </div>
      <div class="form-group">
        <label>Velikost porce</label>
        <select id="portionSize">
          <option value="small (150ml)">Mal√° (150 ml)</option>
          <option value="medium (250ml)" selected>St≈ôedn√≠ (250 ml)</option>
          <option value="large (350ml)">Velk√° (350 ml)</option>
          <option value="XL (500ml)">XL (500 ml)</option>
        </select>
      </div>
      <div class="form-group">
        <label>Cenov√° kategorie</label>
        <select id="priceRange">
          <option value="budget (50-80 CZK)">Budget (50‚Äì80 Kƒç)</option>
          <option value="mid-range (80-130 CZK)" selected>Mid-range (80‚Äì130 Kƒç)</option>
          <option value="premium (130-200 CZK)">Premium (130‚Äì200 Kƒç)</option>
          <option value="specialty (200+ CZK)">Specialty (200+ Kƒç)</option>
        </select>
      </div>
    </div>

    <!-- Tag groups -->
    <div style="margin-bottom:1.25rem">
      <label style="display:block;margin-bottom:.75rem">Chu≈•ov√© preference</label>

      <div class="tag-group">
        <div class="tag-group-label">‚òï Z√°kladn√≠ chu≈•ov√© profily</div>
        <div class="tags-row">
          <button class="tag-btn" onclick="toggleTag(this)">üç¨ Sladk√Ω</button>
          <button class="tag-btn" onclick="toggleTag(this)">üçã Kysel√Ω</button>
          <button class="tag-btn" onclick="toggleTag(this)">üç´ Ho≈ôk√Ω</button>
          <button class="tag-btn" onclick="toggleTag(this)">ü•õ Kr√©mov√Ω</button>
          <button class="tag-btn" onclick="toggleTag(this)">üå∂ Ko≈ôenƒõn√Ω</button>
          <button class="tag-btn" onclick="toggleTag(this)">üåø Bylinn√Ω</button>
          <button class="tag-btn" onclick="toggleTag(this)">üçì Ovocn√Ω</button>
          <button class="tag-btn" onclick="toggleTag(this)">üå∞ O≈ô√≠≈°kov√Ω</button>
          <button class="tag-btn" onclick="toggleTag(this)">üå∏ Kvƒõtinov√Ω</button>
          <button class="tag-btn" onclick="toggleTag(this)">üçµ Zemit√Ω</button>
        </div>
      </div>

      <div class="tag-group">
        <div class="tag-group-label">ü•É S alkoholem</div>
        <div class="tags-row">
          <button class="tag-btn alc" onclick="toggleTag(this)">ü•É Whisky / Bourbon</button>
          <button class="tag-btn alc" onclick="toggleTag(this)">üç∏ Amaretto</button>
          <button class="tag-btn alc" onclick="toggleTag(this)">üçπ Baileys / Irish Cream</button>
          <button class="tag-btn alc" onclick="toggleTag(this)">‚òï Kahl√∫a / Coffee Liqueur</button>
          <button class="tag-btn alc" onclick="toggleTag(this)">ü•Ç Rum</button>
          <button class="tag-btn alc" onclick="toggleTag(this)">üçÉ Gin</button>
        <button class="tag-btn alc" onclick="toggleTag(this)">ü´ô Vodka</button>
        </div>
      </div>

      <div class="tag-group" style="margin-bottom:0">
        <div class="tag-group-label">üßí Pro dƒõti (bez kofeinu)</div>
        <div class="tags-row">
          <button class="tag-btn kid" onclick="toggleTag(this)">üç≠ Hodnƒõ sladk√Ω</button>
          <button class="tag-btn kid" onclick="toggleTag(this)">üç´ ƒåokol√°dov√Ω</button>
          <button class="tag-btn kid" onclick="toggleTag(this)">üçì Jahodov√Ω</button>
          <button class="tag-btn kid" onclick="toggleTag(this)">üç¶ Vanilkov√Ω</button>
          <button class="tag-btn kid" onclick="toggleTag(this)">ü´ê Lesn√≠ ovoce</button>
          <button class="tag-btn kid" onclick="toggleTag(this)">üç™ Su≈°enkov√Ω / Karamelov√Ω</button>
        </div>
      </div>
    </div>

    <div class="form-group" style="margin-bottom:0">
      <label>Alergeny / Omezen√≠ <span style="font-weight:400;text-transform:none;letter-spacing:0;font-family:'DM Sans',sans-serif;font-size:.75rem;color:rgba(122,92,58,.55)">(voliteln√©)</span></label>
      <input type="text" id="restrictions" placeholder="Nap≈ô: bez lakt√≥zy, vegan, bez lepku...">
    </div>

    <button class="generate-btn" onclick="generateRecipe()">‚ú® Vygenerovat recept od AI barisky</button>
  </div>

  <!-- ‚îÄ‚îÄ Loading ‚îÄ‚îÄ -->
  <div class="loading-section" id="loadingSection">
    <div class="bubbles">
      <div class="bubble"></div><div class="bubble"></div><div class="bubble"></div>
      <div class="bubble"></div><div class="bubble"></div><div class="bubble"></div>
    </div>
    <p class="loading-text">Tv≈Øj barista p≈ôipravuje recept...</p>
    <p class="loading-sub" id="loadingStatus">Navrhuje recept</p>
  </div>

  <!-- ‚îÄ‚îÄ Result ‚îÄ‚îÄ -->
  <div class="result-section" id="resultSection">

    <div class="error-banner" id="errorBanner"></div>

    <div class="drink-hero">
      <div>
        <div class="drink-title" id="drinkName">‚Äî</div>
        <div class="drink-subtitle" id="drinkDesc">‚Äî</div>
        <div class="drink-badge" id="drinkBadge">AI Recept</div>
      </div>

    </div>

    <div class="cards-grid">

      <div class="info-card">
        <div class="card-label">üìã Postup p≈ô√≠pravy</div>
        <ol class="step-list" id="stepList"></ol>
      </div>

      <div class="info-card">
        <div class="card-label">üß™ Ingredience <span style="font-size:.68rem;color:var(--muted);font-weight:400;text-transform:none;letter-spacing:0;font-family:'DM Sans',sans-serif;margin-left:.2rem">(upraviteln√©)</span></div>
        <table class="ing-table" id="ingTable">
          <thead><tr>
            <th>Surovina</th>
            <th class="r" style="width:88px">Mno≈æstv√≠</th>
            <th class="r" style="width:72px">Kƒç</th>
            <th style="width:26px"></th>
          </tr></thead>
          <tbody id="ingTbody"></tbody>
        </table>
        <button class="add-btn" onclick="addRow()">+ P≈ôidat ingredienci</button>

        <div class="cost-sep"></div>
        <div class="cost-line sub"><span class="cost-lbl">Suroviny celkem</span><span class="cost-val" id="ingTotal">‚Äî</span></div>
        <div class="cost-line" style="background:rgba(200,130,42,.03)"><span class="cost-lbl">Pr√°ce &amp; energie</span><span class="cost-val sm" id="laborVal">‚Äî</span></div>
        <div class="cost-line tot"><span class="cost-lbl">Celkem / porci</span><span class="cost-val" id="grandVal">‚Äî</span></div>

        <div class="labor-note">
          <strong>Z ƒçeho vych√°z√≠ kalkulace pr√°ce a energie:</strong><br>
          Hrub√° mzda baristy v ƒåR 28‚Äì35 tis. Kƒç/mƒõs. P≈ôi 8h smƒõnƒõ a ~60 n√°poj√≠ch/hod vych√°z√≠ mzda na <strong>5‚Äì8 Kƒç/≈°√°lek</strong>. Energie (stroj ~1,5 kW, ml√Ωnek, chlazen√≠, osvƒõtlen√≠) p≈ôid√°v√° <strong>2‚Äì4 Kƒç</strong>. ƒåistic√≠ prost≈ôedky a opot≈ôeben√≠ ~2 Kƒç. Kalkulace odpov√≠d√° pr≈Ømƒõrn√© ƒçesk√© kav√°rnƒõ.
          <div class="labor-tags">
            <span class="labor-tag">üë§ Mzda: ~6 Kƒç</span>
            <span class="labor-tag">‚ö° Energie: ~3 Kƒç</span>
            <span class="labor-tag">üßπ Provoz: ~2 Kƒç</span>
          </div>
        </div>
        <div class="src-note" id="srcNote"></div>
      </div>

      <div class="info-card highlight">
        <div class="card-label">üìà Prodejn√≠ cena &amp; mar≈æe</div>
        <div class="price-row">
          <span class="price-lbl">Celkov√© n√°klady / porci</span>
          <span class="price-val" id="priceCost">‚Äî</span>
        </div>
        <div class="price-row">
          <span class="price-lbl">Doporuƒçen√° prodejn√≠ cena</span>
          <span class="price-val big" id="priceSell">‚Äî</span>
        </div>
        <div class="price-row">
          <span class="price-lbl">Hrub√° mar≈æe</span>
          <div class="m-dual"><span class="m-czk" id="mCZK">‚Äî</span><span class="m-pct" id="mPCT">‚Äî</span></div>
        </div>
        <div class="m-bar"><div class="m-fill" id="mFill"></div></div>
        <div class="m-scale"><span>0%</span><span id="mLbl">‚Äî</span><span>100%</span></div>

        <div class="slider-box">
          <div class="slider-hd">
            <span class="slider-lbl">üéö Upravit c√≠lovou mar≈æi</span>
            <span class="slider-val" id="sliderPct">70%</span>
          </div>
          <input type="range" id="marginSlider" min="30" max="90" value="70" step="1"
            oninput="onSlider(this.value)" style="--p:70%">
          <div class="slider-scale"><span>30%</span><span>50%</span><span>70%</span><span>90%</span></div>
          <div class="slider-result">
            <span class="slider-result-lbl">Prodejn√≠ cena p≈ôi zvolen√© mar≈æi</span>
            <span class="slider-result-price" id="sliderPrice">‚Äî</span>
          </div>
        </div>
      </div>

      <div class="info-card full market-card">
        <div class="market-lbl">üîç Podobn√© n√°poje na trhu</div>
        <div id="marketResults"><div style="color:rgba(232,213,188,.35);font-style:italic;font-size:.9rem">Naƒç√≠t√°m data...</div></div>
        <div class="market-disc">‚ÑπÔ∏è Data sestavena AI z ve≈ôejn√Ωch zdroj≈Ø. Ceny jsou orientaƒçn√≠ a slou≈æ√≠ jako pr≈Øzkum trhu.</div>
      </div>

      <div class="info-card full">
        <div class="card-label">üë®‚Äçüç≥ Tip od AI barisky</div>
        <p style="font-size:.95rem;line-height:1.75;color:var(--text)" id="baristaTip">‚Äî</p>
      </div>
    </div>

    <button class="reset-btn" onclick="resetForm()">‚Ü© Vytvo≈ôit nov√Ω recept</button>
  </div>
</main>

<!-- ‚ïê‚ïê COOKIE BANNER ‚ïê‚ïê -->
<div id="cookieBanner" role="region" aria-label="Informace o cookies">
  <div class="cookie-text">
    Tato aplikace ukl√°d√° funkƒçn√≠ data do localStorage (spr√°va p≈ô√≠stupu a relace).
    Va≈°e zad√°n√≠ jsou zpracov√°na AI modelem <strong>Anthropic Claude</strong>&nbsp;‚Äî&nbsp;odes√≠l√°me je na servery Anthropic, Inc. (USA).
    <a onclick="openPrivacy()">Z√°sady ochrany osobn√≠ch √∫daj≈Ø</a>
  </div>
  <div class="cookie-btns">
    <button class="cookie-btn cookie-btn-info" onclick="openPrivacy()">V√≠ce informac√≠</button>
    <button class="cookie-btn cookie-btn-accept" onclick="acceptCookies()">Rozum√≠m</button>
  </div>
</div>

<!-- ‚ïê‚ïê PRIVACY MODAL ‚ïê‚ïê -->
<div id="privacyModal" role="dialog" aria-modal="true" aria-labelledby="privacyTitle"
     onclick="if(event.target===this)closePrivacy()">
  <div class="privacy-box">
    <div class="privacy-header">
      <div class="privacy-title" id="privacyTitle">Z√°sady ochrany osobn√≠ch √∫daj≈Ø</div>
      <button class="privacy-close" onclick="closePrivacy()" aria-label="Zav≈ô√≠t">√ó</button>
    </div>
    <div class="privacy-body">

      <h3>Spr√°vce osobn√≠ch √∫daj≈Ø</h3>
      <p>
        <!-- ‚Üì VYPL≈áTE: n√°zev firmy, adresa, IƒåO, kontaktn√≠ e-mail -->
        <strong>[N√°zev va≈°√≠ firmy / ≈æivnosti]</strong><br>
        [Adresa]<br>
        IƒåO: [XXXXXXXX]<br>
        E-mail: <a href="mailto:[vas@email.cz]">[vas@email.cz]</a>
      </p>

      <h3>Jak√° data zpracov√°v√°me</h3>
      <ul>
        <li><strong>P≈ô√≠stupov√© k√≥dy</strong> ‚Äî ulo≈æeny lok√°lnƒõ v prohl√≠≈æeƒçi (localStorage). Nesynchronizujeme je na ≈æ√°dn√Ω server.</li>
        <li><strong>Zad√°n√≠ recept≈Ø</strong> ‚Äî typ n√°poje, chu≈•ov√© preference, omezen√≠ (nap≈ô. ‚Äûbez lakt√≥zy"). Tato data jsou odesl√°na na servery Anthropic, Inc. za √∫ƒçelem generov√°n√≠ receptu.</li>
        <li><strong>Relaƒçn√≠ token</strong> ‚Äî kr√°tkodob√Ω z√°znam o p≈ôihl√°≈°en√≠ ulo≈æen√Ω v localStorage (platnost 30 dn√≠).</li>
      </ul>
      <p>Nezpracov√°v√°me jm√©no, e-mail, adresu ani ≈æ√°dn√© jin√© identifik√°tory u≈æivatele.</p>

      <h3>√öƒçel a pr√°vn√≠ z√°klad zpracov√°n√≠</h3>
      <p>
        Data jsou zpracov√°v√°na v√Ωhradnƒõ za √∫ƒçelem poskytnut√≠ funkce generov√°n√≠ k√°vov√Ωch recept≈Ø
        a kalkulace cen (<strong>opr√°vnƒõn√Ω z√°jem</strong> dle ƒçl. 6 odst. 1 p√≠sm. f) GDPR).
        LocalStorage je vyu≈æ√≠v√°no jako <strong>technicky nezbytn√©</strong> √∫lo≈æi≈°tƒõ pro fungov√°n√≠ p≈ô√≠stupov√© br√°ny.
      </p>

      <h3>P≈ôed√°v√°n√≠ dat t≈ôet√≠m stran√°m</h3>
      <p>
        Va≈°e zad√°n√≠ jsou p≈ôed√°v√°na spoleƒçnosti <strong>Anthropic, Inc.</strong> (USA) jako zpracovateli dat.
        Anthropic zpracov√°v√° data v souladu s vlastn√≠mi z√°sadami ochrany soukrom√≠ a standardn√≠mi smluvn√≠mi dolo≈ækami EU.
        V√≠ce informac√≠: <a href="https://www.anthropic.com/privacy" target="_blank" rel="noopener">anthropic.com/privacy</a>.
      </p>
      <p>Jin√Ωm t≈ôet√≠m stran√°m data nep≈ôed√°v√°me.</p>

      <h3>Ukl√°d√°n√≠ dat (cookies a localStorage)</h3>
      <p>
        Aplikace nepou≈æ√≠v√° cookies. Vyu≈æ√≠v√° <strong>localStorage</strong> prohl√≠≈æeƒçe pro:
      </p>
      <ul>
        <li>Ovƒõ≈ôen√≠ p≈ô√≠stupov√©ho k√≥du a ulo≈æen√≠ relace (30 dn√≠)</li>
        <li>Konfiguraci vstupn√≠ br√°ny (pouze pro spr√°vce)</li>
      </ul>
      <p>Tato data m≈Ø≈æete kdykoli smazat v nastaven√≠ prohl√≠≈æeƒçe (N√°stroje pro v√Ωvoj√°≈ôe ‚Üí Application ‚Üí Local Storage).</p>

      <h3>Doba uchov√°v√°n√≠</h3>
      <p>Relaƒçn√≠ token je platn√Ω 30 dn√≠, pot√© je automaticky zneplatnƒõn. Lok√°ln√≠ data jsou ulo≈æena pouze v prohl√≠≈æeƒçi u≈æivatele.</p>

      <h3>Va≈°e pr√°va</h3>
      <ul>
        <li>Pr√°vo na p≈ô√≠stup k osobn√≠m √∫daj≈Øm</li>
        <li>Pr√°vo na opravu nebo v√Ωmaz</li>
        <li>Pr√°vo vzn√©st n√°mitku proti zpracov√°n√≠</li>
        <li>Pr√°vo podat st√≠≈ænost u √ö≈ôadu pro ochranu osobn√≠ch √∫daj≈Ø (<a href="https://www.uoou.cz" target="_blank" rel="noopener">uoou.cz</a>)</li>
      </ul>
      <p>
        Pro uplatnƒõn√≠ pr√°v n√°s kontaktujte na:
        <!-- ‚Üì VYPL≈áTE: kontaktn√≠ e-mail -->
        <a href="mailto:[vas@email.cz]">[vas@email.cz]</a>
      </p>

      <h3>Aktualizace tƒõchto z√°sad</h3>
      <p>Tyto z√°sady mohou b√Ωt aktualizov√°ny. Datum posledn√≠ zmƒõny: <strong><!-- ‚Üì VYPL≈áTE datum -->1. 3. 2026</strong>.</p>

    </div>
    <div class="privacy-footer">
      <button class="cookie-btn cookie-btn-accept" onclick="acceptCookies();closePrivacy()">Rozum√≠m a zav≈ô√≠t</button>
    </div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ Beans ‚îÄ‚îÄ
(function(){
  const wrap = document.getElementById('beans');
  const colors = ['#3b1a08','#5c3520','#7a4828','#a06040','#2c1a0e','#6b3a1f'];

  function lighten(hex){
    const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);
    return '#'+[r+45,g+28,b+16].map(v=>Math.min(255,v).toString(16).padStart(2,'0')).join('');
  }
  function darken(hex){
    const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);
    return '#'+[r-20,g-12,b-8].map(v=>Math.max(0,v).toString(16).padStart(2,'0')).join('');
  }

  function makeBeanSVG(sz, color, uid){
    const lg = lighten(color), dk = darken(color);
    return `<svg width="${sz}" height="${Math.round(sz*1.45)}" viewBox="0 0 40 58" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <radialGradient id="bg${uid}" cx="36%" cy="32%" r="62%">
          <stop offset="0%" stop-color="${lg}"/>
          <stop offset="100%" stop-color="${color}"/>
        </radialGradient>
      </defs>
      <ellipse cx="20" cy="29" rx="17.5" ry="25" fill="url(#bg${uid})"/>
      <path d="M20 5 Q13 19 13 29 Q13 39 20 53"
        stroke="${dk}" stroke-width="2.4" fill="none" stroke-linecap="round" opacity=".65"/>
      <ellipse cx="12" cy="17" rx="5" ry="7" fill="white" opacity=".09" transform="rotate(-18 12 17)"/>
    </svg>`;
  }

  // Inject keyframe animations once
  const style = document.createElement('style');
  style.textContent = `
    @keyframes beanFloat0{
      0%  {transform:translateY(108vh) rotate(0deg);  opacity:0}
      6%  {opacity:.55}
      94% {opacity:.22}
      100%{transform:translateY(-14vh) rotate(200deg);opacity:0}
    }
    @keyframes beanFloat1{
      0%  {transform:translateY(108vh) translateX(0)   rotate(0deg);  opacity:0}
      6%  {opacity:.5}
      45% {transform:translateY(55vh)  translateX(35px) rotate(95deg);opacity:.4}
      94% {opacity:.18}
      100%{transform:translateY(-14vh) translateX(-25px) rotate(230deg);opacity:0}
    }
  `;
  document.head.appendChild(style);

  for(let i=0;i<14;i++){
    const div   = document.createElement('div');
    div.className = 'bean';
    const sz    = 16 + Math.random() * 20;
    const color = colors[i % colors.length];
    const rot   = Math.floor(Math.random() * 360);
    const dur   = 20 + Math.random() * 18;
    const delay = Math.random() * 22;
    const left  = Math.random() * 100;
    div.style.cssText = `left:${left}%;opacity:0;animation:beanFloat${i%2} ${dur}s ${delay}s linear infinite;transform:rotate(${rot}deg);`;
    div.innerHTML = makeBeanSVG(sz, color, i);
    wrap.appendChild(div);
  }
})();

function toggleTag(btn){btn.classList.toggle('active');}
function getTags(){return[...document.querySelectorAll('.tag-btn.active')].map(b=>b.textContent.trim());}

// ‚îÄ‚îÄ Proxy URL (Vercel serverless function) ‚îÄ‚îÄ
// The API key lives in Vercel environment variables ‚Äî never in this file.
const PROXY_URL = '/api/claude';

// ‚îÄ‚îÄ State ‚îÄ‚îÄ
let _labor=0, _marginPct=70, _ingredients=[];
let _loadInt;
const _msgs=['Navrhuje recept...','Lad√≠ pomƒõry...','Poƒç√≠t√° n√°klady...','Prohled√°v√° trh...','Finalizuje...'];

// ‚îÄ‚îÄ Generate ‚îÄ‚îÄ
async function generateRecipe(){
  const concept   = document.getElementById('concept').value.trim();
  const base      = document.getElementById('coffeeBase').value;
  const drinkType = document.getElementById('drinkType').value;
  const portion   = document.getElementById('portionSize').value;
  const price     = document.getElementById('priceRange').value;
  const restrict  = document.getElementById('restrictions').value.trim();
  const tags      = getTags();

  document.getElementById('inputSection').style.display='none';
  document.getElementById('resultSection').style.display='none';
  document.getElementById('loadingSection').style.display='block';
  document.getElementById('errorBanner').style.display='none';

  let mi=0;
  _loadInt=setInterval(()=>{document.getElementById('loadingStatus').textContent=_msgs[mi++%_msgs.length];},1800);

  const isKids   = base==='kids';
  const alcTags  = ['Whisky','Bourbon','Amaretto','Baileys','Irish Cream','Kahl√∫a','Coffee Liqueur','Rum','Gin','Vodka'];
  const isAlcohol= !isKids && tags.some(t=>alcTags.some(a=>t.includes(a)));

  const prompt=`Jsi expert barista, food business konzultant a market researcher. Vytvo≈ô kompletn√≠ anal√Ωzu ${isKids?'dƒõtsk√©ho n√°poje (BEZ K√ÅVY, BEZ KOFEINU ‚Äî pou≈æij v√Ωhradnƒõ n√°hra≈æku jako Caro, ƒçekankov√° k√°va, jeƒçmen, karob)':'k√°vov√©ho n√°poje'} pro kav√°rnu v ƒåR.

${concept?`Up≈ôesnƒõn√≠: "${concept}"`:'Bez up≈ôesnƒõn√≠ ‚Äî navrhni kreativn√≠ recept dle ostatn√≠ch parametr≈Ø.'}
Z√°klad: ${isKids?'n√°hra≈æka k√°vy (Caro / ƒçekanka / jeƒçmen)':base} | Typ: ${drinkType} | Porce: ${portion}
Cenov√° kategorie: ${price}
Chu≈•: ${tags.filter(t=>!alcTags.some(a=>t.includes(a))).join(', ')||'libovoln√°'}
Omezen√≠: ${restrict||'≈æ√°dn√©'}
${isKids?'KL√çƒåOV√â: dƒõtsk√° varianta ‚Äî ≈æ√°dn√° k√°va, ≈æ√°dn√Ω kofein, ≈æ√°dn√Ω alkohol. Badge = "Kids Drink".':''}
${isAlcohol?`KL√çƒåOV√â: recept obsahuje alkohol (${tags.filter(t=>alcTags.some(a=>t.includes(a))).join(', ')}) ‚Äî uveƒè p≈ôesn√© mno≈æstv√≠, ceny lihovin z ƒåR velkoobchodu. Badge = "Cocktail Coffee".`:''}

Vra≈• POUZE ƒçist√Ω JSON bez markdown:
{
  "name":"Origin√°ln√≠ n√°zev",
  "subtitle":"Poutav√Ω popis 1-2 vƒõty",
  "badge":"Signature",
  "drinkStyle":"latte|iced_latte|frapp√©|cappuccino|flat_white|cold_brew|other",
  "colorScheme":{"liquid":"#hex","foam":"#hex","layer2":"#hex","accent":"#hex","cup":"#hex","garnish":"#hex"},
  "ingredients":[{"name":"N√°zev","amount":"60 ml","costPerPortion":9.0}],
  "steps":["Krok 1","Krok 2","Krok 3","Krok 4","Krok 5"],
  "totalIngredientCost":24.0,
  "laborAndEnergyCost":11.0,
  "recommendedSellPrice":129,
  "grossMarginCZK":94.0,
  "marginPercent":73,
  "baristaTip":"Tip na p≈ô√≠pravu nebo marketing.",
  "priceSourceNote":"Ceny surovin: orientaƒçn√≠ velkoobchodn√≠ pr≈Ømƒõry ƒåR (Makro, Metro, Bidvest).",
  "market":{
    "found":true,
    "results":[{"cafe":"Kav√°rna","location":"Mƒõsto, Zemƒõ","drinkName":"N√°poj","price":"119 Kƒç","note":"Pozn√°mka"}],
    "marketInsight":"1-2 vƒõty o trhu a cen√°ch."
  }
}
Povinnƒõ: ingredients pou≈æ√≠vaj√≠ kl√≠ƒç "costPerPortion". market.results = 3-5 re√°ln√Ωch kav√°ren. P≈ôepoƒçet: 1EUR=25Kƒç, 1USD=23Kƒç.`;

  try{
    const res=await fetch(PROXY_URL,{
      method:'POST',
      headers:{
        'Content-Type':'application/json',
      },
      body:JSON.stringify({
        model:'claude-sonnet-4-20250514',
        max_tokens:2500,
        messages:[{role:'user',content:prompt}]
      })
    });

    if(!res.ok){
      const err=await res.json().catch(()=>({error:{message:'HTTP '+res.status}}));
      throw new Error(err?.error?.message||'HTTP '+res.status);
    }

    const data=await res.json();

    // Check for API-level error
    if(data.type==='error'){
      throw new Error(data.error?.message||'API error');
    }

    const text=data.content.map(b=>b.type==='text'?b.text:'').join('');
    if(!text) throw new Error('Pr√°zdn√° odpovƒõƒè od AI');

    const clean=text.replace(/```json|```/g,'').trim();
    const recipe=JSON.parse(clean);
    clearInterval(_loadInt);
    renderRecipe(recipe);

  }catch(err){
    clearInterval(_loadInt);
    console.error('API error:',err);
    // Show error + fall back to demo
    document.getElementById('loadingSection').style.display='none';
    const eb=document.getElementById('errorBanner');
    eb.textContent='‚ö†Ô∏è '+err.message+' ‚Äî zobrazuji uk√°zkov√Ω recept.';
    eb.style.display='block';
    renderRecipe(getDemo());
  }
}


// ‚îÄ‚îÄ Editable ingredients ‚îÄ‚îÄ
function renderIngTable(ings){
  _ingredients=ings.map(i=>({name:i.name,amount:i.amount||'',cost:parseFloat(i.costPerPortion||i.totalCost||0)}));
  redrawTable();
}

function redrawTable(){
  const tb=document.getElementById('ingTbody');
  tb.innerHTML='';
  _ingredients.forEach((ing,i)=>{
    const tr=document.createElement('tr');
    tr.style.animation=`slideIn .3s ease ${i*.06}s both`;
    tr.innerHTML=`
      <td><input class="ing-input" value="${esc(ing.name)}" placeholder="N√°zev" onchange="upd(${i},'name',this.value)"></td>
      <td><input class="ing-input amt" value="${esc(ing.amount)}" placeholder="60 ml" onchange="upd(${i},'amount',this.value)"></td>
      <td><input class="ing-input cst" type="number" step="0.5" min="0" value="${ing.cost.toFixed(1)}" oninput="upd(${i},'cost',this.value)"></td>
      <td><button class="del-btn" onclick="delRow(${i})">√ó</button></td>`;
    tb.appendChild(tr);
  });
  recalc();
}
function upd(i,f,v){_ingredients[i][f]=f==='cost'?parseFloat(v)||0:v;recalc();}
function delRow(i){_ingredients.splice(i,1);redrawTable();}
function addRow(){
  _ingredients.push({name:'',amount:'',cost:0});
  redrawTable();
  setTimeout(()=>{const r=document.querySelectorAll('#ingTbody .ing-input');if(r.length)r[r.length-3].focus();},40);
}

function recalc(){
  const sum=_ingredients.reduce((s,i)=>s+i.cost,0);
  const tot=sum+_labor;
  document.getElementById('ingTotal').textContent=czk(sum);
  document.getElementById('laborVal').textContent=czk(_labor);
  document.getElementById('grandVal').textContent=czk(tot);
  document.getElementById('priceCost').textContent=czk(tot);
  const sell=tot/(1-_marginPct/100);
  const mczk=sell-tot;
  document.getElementById('priceSell').textContent=czk(Math.round(sell));
  document.getElementById('mCZK').textContent=czk(Math.round(mczk));
  document.getElementById('mPCT').textContent=_marginPct+'%';
  document.getElementById('mLbl').textContent=_marginPct+'%';
  document.getElementById('mFill').style.width=_marginPct+'%';
  document.getElementById('sliderPrice').textContent=czk(Math.round(sell));
}

// ‚îÄ‚îÄ Slider ‚îÄ‚îÄ
function onSlider(v){
  _marginPct=parseInt(v);
  document.getElementById('sliderPct').textContent=_marginPct+'%';
  document.getElementById('marginSlider').style.setProperty('--p',_marginPct+'%');
  recalc();
}

// ‚îÄ‚îÄ Render recipe ‚îÄ‚îÄ
function renderRecipe(r){
  document.getElementById('loadingSection').style.display='none';
  document.getElementById('drinkName').textContent=r.name||'N√°poj';
  document.getElementById('drinkDesc').textContent=r.subtitle||'';
  document.getElementById('drinkBadge').textContent=r.badge||'AI Recept';



  // Steps
  const sl=document.getElementById('stepList');sl.innerHTML='';
  (r.steps||[]).forEach((s,i)=>{
    const li=document.createElement('li');li.className='step-item';li.style.animationDelay=(i*.1)+'s';
    li.innerHTML=`<div class="step-num c${i%6}">${i+1}</div><div class="step-text">${esc(s)}</div>`;
    sl.appendChild(li);
  });

  // Ingredients
  _labor=r.laborAndEnergyCost||11;
  _marginPct=r.marginPercent||70;
  renderIngTable(r.ingredients||[]);
  document.getElementById('srcNote').textContent=r.priceSourceNote||'';

  // Slider initial
  const sl2=document.getElementById('marginSlider');
  sl2.value=_marginPct;
  sl2.style.setProperty('--p',_marginPct+'%');
  document.getElementById('sliderPct').textContent=_marginPct+'%';

  // Animate margin bar
  document.getElementById('mFill').style.width='0%';
  setTimeout(()=>document.getElementById('mFill').style.width=_marginPct+'%',350);

  document.getElementById('baristaTip').textContent=r.baristaTip||'';
  renderMarket(r.market);
  document.getElementById('resultSection').style.display='block';
  window.scrollTo({top:0,behavior:'smooth'});
}

// ‚îÄ‚îÄ Market ‚îÄ‚îÄ
function renderMarket(m){
  const el=document.getElementById('marketResults');
  if(!m||!m.found||!(m.results||[]).length){
    el.innerHTML=`<div class="market-none">Kav√°rny s identick√Ωm n√°pojem nebyly nalezeny ‚Äî va≈°e v√Ωhoda! üöÄ</div>
    ${m?.marketInsight?`<div class="market-insight"><div class="market-insight-lbl">üí° Tr≈æn√≠ kontext</div><div class="market-insight-txt">${m.marketInsight}</div></div>`:''}`;
    return;
  }
  let h=m.results.map((r,i)=>`
    <div class="market-item" style="animation-delay:${i*.1}s">
      <div class="market-name">${esc(r.drinkName)}</div>
      <div class="market-meta"><span class="market-loc">üìç ${esc(r.cafe)} ¬∑ ${esc(r.location)}</span><span class="market-price">${esc(r.price)}</span></div>
      ${r.note?`<div class="market-note">${esc(r.note)}</div>`:''}
    </div>`).join('');
  if(m.marketInsight) h+=`<div class="market-insight"><div class="market-insight-lbl">üí° Tr≈æn√≠ p≈ôehled</div><div class="market-insight-txt">${m.marketInsight}</div></div>`;
  el.innerHTML=h;
}

// ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
function czk(v){return Math.round(+v).toLocaleString('cs-CZ')+'\u00a0Kƒç';}
function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}

// ‚îÄ‚îÄ Demo ‚îÄ‚îÄ
function getDemo(){
  return{
    name:'Zlat√Ω Z√°pad',subtitle:'Espresso s karamelizovan√Ωm medem, sko≈ôic√≠ a o≈ô√≠≈°kov√Ωm ml√©kem ‚Äî jako z√°pad slunce v ≈°√°lku.',
    badge:'Signature',drinkStyle:'latte',
    colorScheme:{liquid:'#c8822a',foam:'#f5ede0',layer2:'#5a2d00',accent:'#d4a843',cup:'#f0e6d3',garnish:'#5c3a1e'},
    ingredients:[
      {name:'Espresso doppio',amount:'60 ml',costPerPortion:9},
      {name:'O≈ô√≠≈°kov√© ml√©ko Oatly Barista',amount:'180 ml',costPerPortion:7},
      {name:'Karamelizovan√Ω med',amount:'15 ml',costPerPortion:4},
      {name:'Sko≈ôicov√Ω sirup',amount:'10 ml',costPerPortion:3},
      {name:'Mo≈ôsk√° s≈Øl ≈°petka',amount:'0.5 g',costPerPortion:0.5}
    ],
    steps:[
      'P≈ôipravte doppio espresso do p≈ôedeh≈ô√°t√©ho ≈°√°lku.',
      'Med zah≈ôejte 30 s do lehk√© karamelizace, p≈ôidejte sko≈ôicov√Ω sirup.',
      'O≈ô√≠≈°kov√© ml√©ko napƒõ≈àte na 65 ¬∞C ‚Äî jemn√° hedv√°bn√° pƒõna.',
      'Vm√≠chejte medovo-sko≈ôicovou smƒõs do espresso.',
      'Nalijte napƒõnƒõn√© ml√©ko, ozdobte sko≈ôic√≠ a mo≈ôskou sol√≠.'
    ],
    totalIngredientCost:23.5,laborAndEnergyCost:11,recommendedSellPrice:119,
    grossMarginCZK:84.5,marginPercent:71,
    baristaTip:'Karamelizaci medu p≈ôipravujte ƒçerstvƒõ pro ka≈æd√Ω ≈°√°lek ‚Äî z√°kazn√≠k≈Øm to ≈ô√≠kejte, je to v√°≈° nejsilnƒõj≈°√≠ prodejn√≠ argument!',
    priceSourceNote:'Ceny surovin: orientaƒçn√≠ pr≈Ømƒõry z velkoobchod≈Ø ƒåR (Makro, Metro).',
    market:{found:true,results:[
      {cafe:'Starbucks',location:'Praha, ƒåR',drinkName:'Honey Oat Milk Latte',price:'139 Kƒç',note:'Sez√≥nn√≠, kombinace medu a alternativn√≠ho ml√©ka'},
      {cafe:'Costa Coffee',location:'Brno, ƒåR',drinkName:'Caramel Oat Latte',price:'129 Kƒç',note:'Karamelov√° varianta s ovesn√Ωm ml√©kem'},
      {cafe:'Black Medicine',location:'Edinburgh, UK',drinkName:'Honey Cinnamon Flat White',price:'138 Kƒç',note:'Specialty s lok√°ln√≠m medem'},
      {cafe:'Intelligentsia Coffee',location:'Chicago, USA',drinkName:'Spiced Honey Latte',price:'161 Kƒç',note:'Prav√Ω sko≈ôicov√Ω extrakt'}
    ],marketInsight:'Honey + alt-milk lattes pat≈ô√≠ mezi nejrychleji rostouc√≠ trendy specialty k√°vy. Typick√© ceny v ƒåR 110‚Äì160 Kƒç, specialty kav√°rny a≈æ 180 Kƒç.'}
  };
}

function resetForm(){
  document.getElementById('resultSection').style.display='none';
  document.getElementById('inputSection').style.display='block';
  document.getElementById('concept').value='';
  document.querySelectorAll('.tag-btn.active').forEach(b=>b.classList.remove('active'));
  _ingredients=[];_labor=0;_marginPct=70;
  window.scrollTo({top:0,behavior:'smooth'});
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ACCESS CODE SYSTEM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const ACCESS_CODES_KEY = 'bai_access_codes';
const ACCESS_SESSION_KEY = 'bai_access_ok';
const ACCESS_CFG_KEY = 'bai_access_cfg';

function getDefaultCodes(){
  return {
    "DEMO-2024": { uses: 999, used: 0, expires: null, label: "Demo k√≥d" },
    "CAFE-0001": { uses: 1, used: 0, expires: "2027-12-31", label: "Kav√°rna 1" },
    "CAFE-0002": { uses: 1, used: 0, expires: "2027-12-31", label: "Kav√°rna 2" },
  };
}

function getAccessCodes(){
  const stored = localStorage.getItem(ACCESS_CODES_KEY);
  if(stored){
    const merged = Object.assign({}, getDefaultCodes(), JSON.parse(stored));
    return merged;
  }
  return getDefaultCodes();
}

function saveAccessCodes(codes){
  localStorage.setItem(ACCESS_CODES_KEY, JSON.stringify(codes));
}

function getAccessCfg(){
  return JSON.parse(localStorage.getItem(ACCESS_CFG_KEY) || '{}');
}

function applyGateCfg(){
  const cfg = getAccessCfg();
  if(cfg.gateDesc) document.getElementById('gateDesc').innerHTML = cfg.gateDesc;
  if(cfg.contact) document.getElementById('gateContactLink').href = 'mailto:'+cfg.contact;
  if(cfg.gateFooterNote) document.getElementById('gateFooterNote').textContent = cfg.gateFooterNote;
}

function formatGateCode(inp){
  let v = inp.value.replace(/[^A-Za-z0-9]/g,'').toUpperCase();
  if(v.length > 4) v = v.slice(0,4) + '-' + v.slice(4,8);
  inp.value = v;
}

function checkAccessCode(){
  const raw = document.getElementById('gateCodeInput').value.trim().toUpperCase();
  const inp = document.getElementById('gateCodeInput');
  const errEl = document.getElementById('gateErr');
  const defaults = getDefaultCodes();
  const stored = JSON.parse(localStorage.getItem(ACCESS_CODES_KEY) || '{}');
  const codes = Object.assign({}, defaults, stored);
  const code = codes[raw];

  errEl.textContent = '';

  if(!code){
    showGateError(inp, errEl, 'K√≥d nebyl nalezen. Zkontrolujte zad√°n√≠.');
    return;
  }
  if(code.expires && new Date(code.expires) < new Date()){
    showGateError(inp, errEl, 'Platnost k√≥du vypr≈°ela. Kontaktujte n√°s pro obnovu.');
    return;
  }
  if(code.uses > 0 && code.used >= code.uses){
    showGateError(inp, errEl, 'Tento k√≥d byl ji≈æ pou≈æit. Kontaktujte n√°s.');
    return;
  }

  code.used = (code.used || 0) + 1;
  saveAccessCodes(codes);

  const expiry = Date.now() + 30 * 24 * 60 * 60 * 1000;
  localStorage.setItem(ACCESS_SESSION_KEY, JSON.stringify({ code: raw, expiry }));

  const gate = document.getElementById('accessGate');
  gate.style.transition = 'opacity .4s ease';
  gate.style.opacity = '0';
  setTimeout(()=> gate.style.display = 'none', 420);
}

function showGateError(inp, errEl, msg){
  errEl.textContent = msg;
  inp.classList.add('error');
  setTimeout(()=> inp.classList.remove('error'), 400);
}

function checkExistingSession(){
  try{
    const s = JSON.parse(localStorage.getItem(ACCESS_SESSION_KEY) || 'null');
    if(s && s.expiry > Date.now()){
      document.getElementById('accessGate').style.display = 'none';
    }
  } catch(e){}
}

applyGateCfg();
checkExistingSession();

// ‚îÄ‚îÄ GDPR Cookie Banner ‚îÄ‚îÄ
const CONSENT_KEY = 'bai_cookie_consent';

function initCookieBanner(){
  if(!localStorage.getItem(CONSENT_KEY)){
    setTimeout(()=> document.getElementById('cookieBanner').classList.add('show'), 600);
  }
}

function acceptCookies(){
  localStorage.setItem(CONSENT_KEY, '1');
  document.getElementById('cookieBanner').classList.remove('show');
}

function openPrivacy(){
  document.getElementById('privacyModal').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closePrivacy(){
  document.getElementById('privacyModal').classList.remove('open');
  document.body.style.overflow = '';
}

// Close privacy modal on Escape key
document.addEventListener('keydown', e => {
  if(e.key === 'Escape') closePrivacy();
});

initCookieBanner();

</script>
</body>
</html>
