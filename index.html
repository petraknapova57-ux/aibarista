<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BaristaAI â€” Receptury & Kalkulace</title>
<meta name="theme-color" content="#2c1a0e">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="BaristaAI">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Lato:ital,wght@0,300;0,400;0,700;1,400&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root{
  /* Core palette */
  --red:     #c0392b;   /* main accent â€” warm deep red */
  --red-soft:#e8504a;   /* hover / lighter red */
  --red-pale:#fdf0ef;   /* red tint backgrounds */
  --espresso:#2c1a0e;   /* darkest brown â€” headings */
  --roast:   #5c3520;   /* medium brown */
  --latte:   #c4a882;   /* warm tan */
  --cream:   #faf6f0;   /* warm white */
  --sage:    #6a9e7a;   /* success / kids */

  --bg:      #f7f2eb;
  --surface: #fffcf8;
  --text:    #2c1a0e;
  --muted:   #8a7060;
  --border:  rgba(196,168,130,.25);
  --shadow:  0 2px 20px rgba(44,26,14,.08);
}

*{margin:0;padding:0;box-sizing:border-box;}

body{
  font-family:'Lato',sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  overflow-x:hidden;
}

/* Warm layered background */
body::before{
  content:'';position:fixed;inset:0;z-index:-2;
  background:
    radial-gradient(ellipse at 100% 0%,   rgba(192,57,43,.07)  0%, transparent 45%),
    radial-gradient(ellipse at 0%   100%, rgba(196,168,130,.12) 0%, transparent 50%),
    radial-gradient(ellipse at 50%  50%,  rgba(250,246,240,.9)  0%, transparent 70%),
    #f7f2eb;
}
/* Subtle dot texture */
body::after{
  content:'';position:fixed;inset:0;z-index:-1;
  background-image:url("data:image/svg+xml,%3Csvg width='32' height='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='16' cy='16' r='.8' fill='%23c4a882' fill-opacity='0.15'/%3E%3C/svg%3E");
}

/* â”€â”€ Header â”€â”€ */
header{
  padding:0;
  display:flex;align-items:stretch;
  background:var(--espresso);
  position:sticky;top:0;z-index:100;
  animation:fadeDown .7s ease;
  box-shadow:0 2px 12px rgba(44,26,14,.25);
}
.header-inner{
  display:flex;align-items:center;justify-content:space-between;
  width:100%;max-width:1100px;margin:0 auto;padding:1.1rem 2rem;
}
.logo{
  font-family:'Playfair Display',serif;
  font-size:1.7rem;font-weight:700;
  color:var(--cream);
  letter-spacing:-.2px;
}
.logo span{ color:var(--red-soft); font-style:italic; }
.tagline{
  font-family:'Lato',sans-serif;font-size:.65rem;
  color:rgba(250,246,240,.45);letter-spacing:2px;text-transform:uppercase;
}

/* â”€â”€ Layout â”€â”€ */
main{max-width:1100px;margin:0 auto;padding:3rem 2rem;}

/* â”€â”€ Hero â”€â”€ */
.hero{text-align:center;margin-bottom:3rem;animation:fadeUp 1s ease .2s both;}
.hero h1{
  font-family:'Playfair Display',serif;font-weight:700;
  font-size:clamp(2.2rem,5vw,3.6rem);
  color:var(--espresso);line-height:1.18;margin-bottom:1rem;
}
.hero h1 em{ color:var(--red); font-style:italic; }
.hero p{color:var(--muted);font-size:1rem;max-width:520px;margin:0 auto;line-height:1.75;}

/* â”€â”€ Red accent strip on form card top â”€â”€ */
.input-card{
  background:var(--surface);
  border-radius:16px;padding:2.5rem;
  border:1px solid var(--border);
  box-shadow:var(--shadow);
  border-top:3px solid var(--red);
  animation:fadeUp 1s ease .4s both;margin-bottom:2rem;
}
.input-card h2{
  font-family:'Playfair Display',serif;font-size:1.35rem;font-weight:600;
  color:var(--espresso);margin-bottom:1.5rem;
}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.25rem;margin-bottom:1.5rem;}
.form-group{display:flex;flex-direction:column;gap:.4rem;}
.form-group.full{grid-column:1/-1;}
label{
  font-family:'Lato',sans-serif;font-size:.67rem;font-weight:700;
  letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);
}
input,select,textarea{
  font-family:'Lato',sans-serif;font-size:.93rem;
  padding:.72rem 1rem;
  border:1px solid rgba(196,168,130,.3);
  border-radius:8px;background:#fffcf8;
  color:var(--text);transition:all .18s;outline:none;
}
input:focus,select:focus,textarea:focus{
  border-color:var(--red);background:#fff;
  box-shadow:0 0 0 3px rgba(192,57,43,.1);
}
textarea{resize:vertical;min-height:88px;line-height:1.6;}

/* â”€â”€ Tag groups â”€â”€ */
.tag-group{margin-bottom:.9rem;}
.tag-group-label{
  font-family:'Lato',sans-serif;font-size:.62rem;font-weight:700;
  letter-spacing:1.8px;text-transform:uppercase;color:var(--muted);
  margin-bottom:.5rem;display:flex;align-items:center;gap:.5rem;
}
.tag-group-label::after{content:'';flex:1;height:1px;background:var(--border);}
.tags-row{display:flex;flex-wrap:wrap;gap:.4rem;}

.tag-btn{
  font-family:'Lato',sans-serif;font-size:.75rem;font-weight:600;
  padding:.32rem .85rem;border-radius:20px;
  border:1px solid rgba(196,168,130,.35);
  background:#fffcf8;color:var(--muted);
  cursor:pointer;transition:all .18s;
}
.tag-btn:hover{ border-color:var(--red);color:var(--red);background:var(--red-pale);}
.tag-btn.active{ background:var(--red);border-color:var(--red);color:#fff;}

/* Alcohol â€” dark roast */
.tag-btn.alc{ border-color:rgba(92,53,32,.3);color:var(--roast);}
.tag-btn.alc:hover{ background:rgba(92,53,32,.07);border-color:var(--roast);color:var(--espresso);}
.tag-btn.alc.active{ background:var(--roast);border-color:var(--roast);color:#fff;}

/* Kids â€” sage */
.tag-btn.kid{ border-color:rgba(106,158,122,.35);color:#3a7050;}
.tag-btn.kid:hover{ background:rgba(106,158,122,.1);border-color:var(--sage);}
.tag-btn.kid.active{ background:var(--sage);border-color:var(--sage);color:#fff;}

/* â”€â”€ Generate button â”€â”€ */
.generate-btn{
  width:100%;padding:.95rem 2rem;
  background:var(--red);
  color:#fff;border:none;border-radius:10px;
  font-family:'Lato',sans-serif;font-size:.95rem;font-weight:700;letter-spacing:.5px;
  cursor:pointer;transition:all .25s;
  display:flex;align-items:center;justify-content:center;gap:.6rem;
  margin-top:1.25rem;
  box-shadow:0 4px 16px rgba(192,57,43,.3);
}
.generate-btn:hover{background:var(--red-soft);transform:translateY(-1px);box-shadow:0 6px 22px rgba(192,57,43,.38);}
.generate-btn:active{transform:translateY(0);}

/* â”€â”€ Loading â”€â”€ */
.loading-section{display:none;text-align:center;padding:4rem;}
.bubbles{display:flex;justify-content:center;gap:10px;margin-bottom:1.5rem;}
.bubble{width:11px;height:11px;border-radius:50%;animation:bounce 1.3s ease-in-out infinite;}
.bubble:nth-child(1){background:var(--red);      animation-delay:0s;}
.bubble:nth-child(2){background:var(--latte);    animation-delay:.15s;}
.bubble:nth-child(3){background:var(--red-soft); animation-delay:.3s;}
.bubble:nth-child(4){background:var(--roast);    animation-delay:.45s;}
.bubble:nth-child(5){background:var(--red);      animation-delay:.6s;}
.bubble:nth-child(6){background:var(--latte);    animation-delay:.75s;}
@keyframes bounce{0%,80%,100%{transform:translateY(0);opacity:.4}40%{transform:translateY(-14px);opacity:1}}
.loading-text{font-family:'Playfair Display',serif;font-size:1.25rem;font-style:italic;color:var(--espresso);}
.loading-sub{font-size:.68rem;color:var(--muted);letter-spacing:1.5px;text-transform:uppercase;margin-top:.5rem;}

/* â”€â”€ Result â”€â”€ */
.result-section{display:none;animation:fadeUp .7s ease;}
.drink-hero{margin-bottom:2rem;}
.drink-title{font-family:'Playfair Display',serif;font-weight:700;font-size:clamp(2rem,4vw,3rem);color:var(--espresso);line-height:1.1;}
.drink-subtitle{color:var(--muted);font-size:.93rem;margin-top:.5rem;line-height:1.7;}
.drink-badge{
  display:inline-block;background:var(--red);
  color:#fff;padding:.35rem 1rem;border-radius:4px;
  font-family:'Lato',sans-serif;font-size:.65rem;font-weight:700;
  letter-spacing:1.8px;text-transform:uppercase;margin-top:.75rem;
}

/* â”€â”€ Cards â”€â”€ */
.cards-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:1.5rem;}
.info-card{
  background:var(--surface);border-radius:14px;padding:1.75rem;
  border:1px solid var(--border);box-shadow:var(--shadow);
}
.info-card.full{grid-column:1/-1;}
.info-card.highlight{border-top:3px solid var(--sage);background:linear-gradient(160deg,#fffcf8,#f4faf6);}
.card-label{
  font-family:'Lato',sans-serif;font-size:.66rem;font-weight:700;
  letter-spacing:2px;text-transform:uppercase;color:var(--muted);
  margin-bottom:1rem;display:flex;align-items:center;gap:.5rem;
}
.card-label::after{content:'';flex:1;height:1px;background:var(--border);}

/* â”€â”€ Steps â”€â”€ */
.step-list{list-style:none;}
.step-item{display:flex;gap:1rem;padding:.72rem 0;border-bottom:1px solid var(--border);animation:slideIn .4s ease both;}
.step-item:last-child{border-bottom:none;}
.step-num{
  width:26px;height:26px;flex-shrink:0;margin-top:.15rem;
  border-radius:50%;display:flex;align-items:center;justify-content:center;
  font-family:'Lato',sans-serif;font-size:.7rem;font-weight:700;
}
.step-num.c0,.step-num.c2,.step-num.c4{background:var(--red);color:#fff;}
.step-num.c1,.step-num.c3,.step-num.c5{background:var(--espresso);color:var(--cream);}
.step-text{font-size:.92rem;line-height:1.65;color:var(--text);}

/* â”€â”€ Editable ingredients â”€â”€ */
.ing-table{width:100%;border-collapse:collapse;margin-bottom:.5rem;}
.ing-table th{font-family:'Lato',sans-serif;font-size:.62rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);padding:.45rem .5rem;border-bottom:2px solid var(--border);text-align:left;}
.ing-table th.r{text-align:right;}
.ing-table td{padding:.3rem .4rem;border-bottom:1px solid rgba(196,168,130,.12);vertical-align:middle;}
.ing-table tr:last-child td{border-bottom:none;}
.ing-input{font-family:'Lato',sans-serif;font-size:.88rem;padding:.3rem .5rem;border:1px solid transparent;border-radius:6px;background:transparent;color:var(--text);width:100%;transition:all .18s;outline:none;}
.ing-input:hover{border-color:rgba(196,168,130,.3);background:rgba(200,168,130,.05);}
.ing-input:focus{border-color:var(--red);background:#fff;box-shadow:0 0 0 2px rgba(192,57,43,.09);}
.ing-input.amt{font-family:'DM Mono',monospace;font-size:.82rem;color:var(--roast);text-align:right;}
.ing-input.cst{font-family:'DM Mono',monospace;font-size:.82rem;color:var(--roast);text-align:right;width:68px;}
.del-btn{width:24px;height:24px;border:none;background:rgba(192,57,43,.1);color:var(--red);border-radius:6px;cursor:pointer;font-size:.95rem;line-height:1;display:flex;align-items:center;justify-content:center;transition:all .15s;}
.del-btn:hover{background:var(--red);color:#fff;}
.add-btn{margin-top:.65rem;width:100%;padding:.5rem;background:transparent;border:1px dashed rgba(196,168,130,.4);border-radius:8px;color:var(--muted);font-family:'Lato',sans-serif;font-size:.76rem;font-weight:600;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:.4rem;}
.add-btn:hover{border-color:var(--red);color:var(--red);background:var(--red-pale);}

/* â”€â”€ Cost summary â”€â”€ */
.cost-sep{height:1px;background:var(--border);margin:.65rem 0;}
.cost-line{display:flex;justify-content:space-between;align-items:center;padding:.45rem .5rem;border-radius:7px;}
.cost-line.sub{background:rgba(196,168,130,.09);}
.cost-line.tot{background:var(--red-pale);border:1px solid rgba(192,57,43,.18);margin-top:.35rem;}
.cost-lbl{font-family:'Lato',sans-serif;font-size:.67rem;font-weight:700;letter-spacing:1.2px;text-transform:uppercase;color:var(--muted);}
.cost-val{font-family:'Playfair Display',serif;font-size:1.25rem;color:var(--espresso);font-weight:700;}
.cost-val.sm{font-family:'DM Mono',monospace;font-size:.86rem;font-weight:400;color:var(--roast);}
.labor-note{margin-top:.9rem;padding-top:.85rem;border-top:1px dashed var(--border);font-size:.77rem;color:var(--muted);line-height:1.65;}
.labor-note strong{color:var(--text);}
.labor-tags{display:flex;flex-wrap:wrap;gap:.4rem;margin-top:.55rem;}
.labor-tag{background:rgba(196,168,130,.1);border:1px solid var(--border);border-radius:5px;padding:.2rem .55rem;font-family:'Lato',sans-serif;font-size:.63rem;color:var(--muted);}
.src-note{font-size:.6rem;color:rgba(138,112,96,.45);margin-top:.7rem;line-height:1.5;}

/* â”€â”€ Pricing card â”€â”€ */
.price-row{display:flex;justify-content:space-between;align-items:center;padding:.7rem 0;border-bottom:1px solid var(--border);}
.price-row:last-child{border-bottom:none;}
.price-lbl{font-size:.9rem;color:var(--text);}
.price-val{font-family:'DM Mono',monospace;font-size:.92rem;color:var(--roast);font-weight:500;}
.price-val.big{font-family:'Playfair Display',serif;font-size:1.65rem;color:var(--sage);font-weight:700;}
.m-dual{display:flex;gap:.6rem;align-items:center;}
.m-czk{font-family:'DM Mono',monospace;font-size:.92rem;color:var(--roast);}
.m-pct{font-family:'Lato',sans-serif;font-size:.75rem;color:var(--muted);background:rgba(196,168,130,.14);padding:.15rem .5rem;border-radius:5px;}
.m-bar{background:rgba(196,168,130,.18);border-radius:100px;height:6px;margin-top:.8rem;overflow:hidden;}
.m-fill{height:100%;background:linear-gradient(90deg,var(--red),var(--latte));border-radius:100px;transition:width .55s ease;width:0%;}
.m-scale{display:flex;justify-content:space-between;margin-top:.3rem;font-size:.6rem;color:rgba(138,112,96,.45);}
.slider-box{margin-top:1.1rem;padding:1rem;border:1px solid var(--border);border-radius:10px;background:rgba(196,168,130,.04);}
.slider-hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:.7rem;}
.slider-lbl{font-family:'Lato',sans-serif;font-size:.64rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);}
.slider-val{font-family:'DM Mono',monospace;font-size:.9rem;color:var(--red);font-weight:500;}
input[type=range]{-webkit-appearance:none;appearance:none;width:100%;height:5px;background:linear-gradient(90deg,var(--red) var(--p,70%),rgba(196,168,130,.22) var(--p,70%));border-radius:100px;cursor:pointer;outline:none;border:none;padding:0;}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;background:var(--red);border-radius:50%;cursor:pointer;box-shadow:0 2px 8px rgba(192,57,43,.3);transition:transform .15s;border:2px solid #fff;}
input[type=range]::-webkit-slider-thumb:hover{transform:scale(1.15);}
input[type=range]::-moz-range-thumb{width:20px;height:20px;border:2px solid #fff;background:var(--red);border-radius:50%;}
.slider-scale{display:flex;justify-content:space-between;margin-top:.32rem;font-size:.6rem;color:rgba(138,112,96,.4);}
.slider-result{margin-top:.8rem;background:rgba(106,158,122,.07);border:1px solid rgba(106,158,122,.25);border-radius:9px;padding:.8rem 1rem;display:flex;justify-content:space-between;align-items:center;}
.slider-result-lbl{font-size:.88rem;color:var(--text);}
.slider-result-price{font-family:'Playfair Display',serif;font-size:1.35rem;color:var(--sage);font-weight:700;}

/* â”€â”€ Market â”€â”€ */
.market-card{background:var(--espresso);border:none;border-radius:14px;padding:1.75rem;}
.market-lbl{font-family:'Lato',sans-serif;font-size:.66rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:rgba(250,246,240,.5);margin-bottom:1rem;display:flex;align-items:center;gap:.5rem;}
.market-lbl::after{content:'';flex:1;height:1px;background:rgba(250,246,240,.12);}
.market-item{padding:.85rem 0;border-bottom:1px solid rgba(250,246,240,.08);animation:slideIn .4s ease both;}
.market-item:last-child{border-bottom:none;}
.market-name{font-size:.93rem;color:var(--cream);font-weight:600;}
.market-meta{display:flex;justify-content:space-between;align-items:center;margin-top:.28rem;}
.market-loc{font-size:.77rem;color:rgba(250,246,240,.4);}
.market-price{font-family:'DM Mono',monospace;font-size:.86rem;color:var(--red-soft);font-weight:700;}
.market-note{font-size:.76rem;color:rgba(250,246,240,.35);margin-top:.22rem;font-style:italic;}
.market-insight{margin-top:.9rem;padding:.8rem 1rem;background:rgba(255,255,255,.05);border-radius:9px;border:1px solid rgba(250,246,240,.1);}
.market-insight-lbl{font-family:'Lato',sans-serif;font-size:.61rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:rgba(250,246,240,.4);margin-bottom:.38rem;}
.market-insight-txt{font-size:.84rem;color:rgba(250,246,240,.65);line-height:1.65;}
.market-none{text-align:center;padding:1rem 0;color:rgba(250,246,240,.4);font-size:.9rem;font-style:italic;}
.market-disc{margin-top:.9rem;font-size:.6rem;color:rgba(250,246,240,.25);line-height:1.55;}

/* â”€â”€ Error banner â”€â”€ */
.error-banner{background:var(--red-pale);border:1px solid rgba(192,57,43,.3);border-radius:10px;padding:1rem 1.25rem;margin-bottom:1.5rem;font-size:.87rem;color:var(--red);display:none;animation:fadeUp .4s ease;}

/* â”€â”€ Reset button â”€â”€ */
.reset-btn{margin:2rem auto 0;display:block;padding:.7rem 2rem;background:transparent;border:1px solid rgba(196,168,130,.4);border-radius:8px;color:var(--muted);font-family:'Lato',sans-serif;font-size:.74rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;cursor:pointer;transition:all .2s;}
.reset-btn:hover{border-color:var(--red);color:var(--red);background:var(--red-pale);}

/* â”€â”€ Floating coffee beans â”€â”€ */
.beans{position:fixed;top:0;left:0;width:100%;height:100vh;pointer-events:none;z-index:-1;overflow:hidden;}
.bean{position:absolute;line-height:0;}

@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeDown{from{opacity:0;transform:translateY(-12px)}to{opacity:1;transform:translateY(0)}}
@keyframes slideIn{from{opacity:0;transform:translateX(-8px)}to{opacity:1;transform:translateX(0)}}
/* floatUp replaced by beanFloat0/1 */

@media(max-width:780px){
  header{padding:0}
  .header-inner{padding:1rem 1.5rem}
  main{padding:2rem 1rem}
  .form-grid,.cards-grid{grid-template-columns:1fr}
  .input-card{padding:1.5rem}
}

/* â•â• ACCESS GATE â•â• */
#accessGate{
  position:fixed;inset:0;z-index:9000;
  background:var(--bg);
  display:flex;align-items:center;justify-content:center;
  padding:1.5rem;
}
.gate-box{
  background:var(--surface);
  border-radius:20px;
  padding:3rem 2.5rem;
  border:1px solid var(--border);
  border-top:3px solid var(--red);
  box-shadow:0 8px 40px rgba(44,26,14,.12);
  width:100%;max-width:420px;
  text-align:center;
  animation:fadeUp .6s ease;
}
.gate-logo{
  font-family:'Playfair Display',serif;
  font-size:2rem;font-weight:700;
  color:var(--espresso);margin-bottom:.3rem;
}
.gate-logo span{color:var(--red-soft);font-style:italic;}
.gate-tagline{
  font-size:.68rem;color:var(--muted);
  letter-spacing:2px;text-transform:uppercase;
  margin-bottom:2rem;
}
.gate-title{
  font-family:'Playfair Display',serif;
  font-size:1.25rem;color:var(--espresso);
  margin-bottom:.5rem;
}
.gate-desc{
  font-size:.88rem;color:var(--muted);
  line-height:1.65;margin-bottom:1.75rem;
}
.gate-input-wrap{position:relative;margin-bottom:.9rem;}
.gate-input{
  width:100%;padding:.85rem 1rem;
  font-family:'DM Mono',monospace;font-size:1rem;
  letter-spacing:3px;text-align:center;text-transform:uppercase;
  border:1.5px solid rgba(196,168,130,.4);
  border-radius:10px;background:#fffcf8;
  color:var(--espresso);outline:none;transition:all .2s;
}
.gate-input:focus{border-color:var(--red);box-shadow:0 0 0 3px rgba(192,57,43,.1);}
.gate-input.error{border-color:var(--red);animation:shake .35s ease;}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}
.gate-btn{
  width:100%;padding:.9rem;
  background:var(--red);color:#fff;border:none;border-radius:10px;
  font-family:'Lato',sans-serif;font-size:.95rem;font-weight:700;
  letter-spacing:.5px;cursor:pointer;transition:all .25s;
  box-shadow:0 4px 16px rgba(192,57,43,.28);
}
.gate-btn:hover{background:var(--red-soft);transform:translateY(-1px);}
.gate-btn:active{transform:translateY(0);}
.gate-err{
  font-size:.8rem;color:var(--red);
  min-height:1.2em;margin-top:.5rem;
  font-weight:600;
}
.gate-footer{
  margin-top:1.75rem;padding-top:1.25rem;
  border-top:1px solid var(--border);
  font-size:.78rem;color:var(--muted);
  line-height:1.7;
}
.gate-footer a{color:var(--red);text-decoration:none;font-weight:700;}
.gate-footer a:hover{text-decoration:underline;}

</style>
  <!-- App Icon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3CradialGradient id='bg' cx='50%25' cy='35%25'%3E%3Cstop offset='0%25' stop-color='%23faf6f0'/%3E%3Cstop offset='100%25' stop-color='%23f7f2eb'/%3E%3C/radialGradient%3E%3CradialGradient id='bean' cx='40%25' cy='35%25'%3E%3Cstop offset='0%25' stop-color='%237a4828'/%3E%3Cstop offset='100%25' stop-color='%233b1a08'/%3E%3C/radialGradient%3E%3C/defs%3E%3Crect width='100' height='100' fill='url(%23bg)' rx='18'/%3E%3Cellipse cx='50' cy='55' rx='21' ry='29' fill='url(%23bean)'/%3E%3Cpath d='M50 30 Q45 43 45 55 Q45 67 50 80' stroke='%232c1a0e' stroke-width='2.5' fill='none' stroke-linecap='round' opacity='.6'/%3E%3Ctext x='50' y='22' font-family='serif' font-size='14' font-weight='700' fill='%23c0392b' text-anchor='middle' font-style='italic'%3EAI%3C/text%3E%3C/svg%3E">
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3CradialGradient id='bg' cx='50%25' cy='35%25'%3E%3Cstop offset='0%25' stop-color='%23faf6f0'/%3E%3Cstop offset='100%25' stop-color='%23f7f2eb'/%3E%3C/radialGradient%3E%3CradialGradient id='bean' cx='40%25' cy='35%25'%3E%3Cstop offset='0%25' stop-color='%237a4828'/%3E%3Cstop offset='100%25' stop-color='%233b1a08'/%3E%3C/radialGradient%3E%3C/defs%3E%3Crect width='100' height='100' fill='url(%23bg)' rx='18'/%3E%3Cellipse cx='50' cy='55' rx='21' ry='29' fill='url(%23bean)'/%3E%3Cpath d='M50 30 Q45 43 45 55 Q45 67 50 80' stroke='%232c1a0e' stroke-width='2.5' fill='none' stroke-linecap='round' opacity='.6'/%3E%3Ctext x='50' y='22' font-family='serif' font-size='14' font-weight='700' fill='%23c0392b' text-anchor='middle' font-style='italic'%3EAI%3C/text%3E%3C/svg%3E">
  <meta name="theme-color" content="#c0392b">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="BaristaAI">

</head>
<body>

<!-- â•â• ACCESS GATE â•â• -->
<div id="accessGate">
  <div class="gate-box">
    <div class="gate-logo">Barista<span>AI</span></div>
    <div class="gate-tagline">AI pomocnÃ­k pro vaÅ¡i kavÃ¡rnu</div>
    <div class="gate-title">Zadejte pÅ™Ã­stupovÃ½ kÃ³d</div>
    <div class="gate-desc" id="gateDesc">
      TestovacÃ­ demo verze BaristaAI.<br>
      Zadejte pÅ™Ã­stupovÃ½ kÃ³d pro pokraÄovÃ¡nÃ­.
    </div>
    <div class="gate-input-wrap">
      <input class="gate-input" id="gateCodeInput"
        placeholder="XXXX-XXXX"
        maxlength="9"
        oninput="formatGateCode(this)"
        onkeydown="if(event.key==='Enter')checkAccessCode()">
    </div>
    <button class="gate-btn" onclick="checkAccessCode()">Aktivovat pÅ™Ã­stup â†’</button>
    <div class="gate-err" id="gateErr"></div>
    <div class="gate-footer" id="gateFooter">
      NemÃ¡te jeÅ¡tÄ› kÃ³d?
      <a href="mailto:info@example.com" id="gateContactLink">Kontaktujte nÃ¡s</a>
      a zÃ­skÃ¡te testovacÃ­ pÅ™Ã­stup.<br>
      <span style="font-size:.72rem;opacity:.7" id="gateFooterNote">Demo verze â€” kÃ³d platÃ­ 30 dnÃ­.</span>
    </div>
  </div>
</div>

<div class="beans" id="beans"></div>
<header>
  <div class="header-inner">
    <div class="logo">Barista<span>AI</span></div>
    <div class="tagline">AI pomocnÃ­k pro vaÅ¡i kavÃ¡rnu</div>
  </div>
</header>

<main>
  <section class="hero">
    <h1>VytvoÅ™ <em>recept</em> na kÃ¡vovÃ½ nÃ¡poj<br><em>za pÃ¡r minut</em> â€” vÄetnÄ› nÃ¡kladÅ¯, ceny a marÅ¾e.</h1>
    <p>TvÅ¯j AI barista poradÃ­ s receptem, nÃ¡klady i prodejnÃ­ cenou â€” a zjistÃ­, jak to majÃ­ tvoji konkurenti.</p>
  </section>

  <!-- â”€â”€ Form â”€â”€ -->
  <div class="input-card" id="inputSection">
    <h2>PopiÅ¡te svÅ¯j nÃ¡poj</h2>

    <div class="form-grid">
      <div class="form-group full">
        <label>UpÅ™esnÄ›nÃ­ <span style="font-weight:400;text-transform:none;letter-spacing:0;font-family:'DM Sans',sans-serif;font-size:.75rem;color:rgba(122,92,58,.55)">(nepovinnÃ©)</span></label>
        <textarea id="concept" placeholder="Nechte prÃ¡zdnÃ© a AI navrhne recept sama â€” nebo upÅ™esnÄ›te: 'letnÃ­ nÃ¡poj s mangem', 'hÅ™ejivÃ½ zimnÃ­ drink s koÅ™enÃ­m'..."></textarea>
      </div>
      <div class="form-group">
        <label>ZÃ¡klad nÃ¡poje</label>
        <select id="coffeeBase">
          <option value="espresso">Espresso</option>
          <option value="ristretto">Ristretto</option>
          <option value="lungo">Lungo</option>
          <option value="cold brew">Cold Brew</option>
          <option value="aeropress">AeroPress</option>
          <option value="pour over">Pour Over</option>
          <option value="kids">ğŸ§’ Varianta pro dÄ›ti (bez kÃ¡vy)</option>
        </select>
      </div>
      <div class="form-group">
        <label>Typ nÃ¡poje</label>
        <select id="drinkType">
          <option value="hot">HorkÃ½</option>
          <option value="iced">LedovÃ½</option>
          <option value="blended">Blended / FrappÃ©</option>
          <option value="any">AI rozhodne</option>
        </select>
      </div>
      <div class="form-group">
        <label>Velikost porce</label>
        <select id="portionSize">
          <option value="small (150ml)">MalÃ¡ (150 ml)</option>
          <option value="medium (250ml)" selected>StÅ™ednÃ­ (250 ml)</option>
          <option value="large (350ml)">VelkÃ¡ (350 ml)</option>
          <option value="XL (500ml)">XL (500 ml)</option>
        </select>
      </div>
      <div class="form-group">
        <label>CenovÃ¡ kategorie</label>
        <select id="priceRange">
          <option value="budget (50-80 CZK)">Budget (50â€“80 KÄ)</option>
          <option value="mid-range (80-130 CZK)" selected>Mid-range (80â€“130 KÄ)</option>
          <option value="premium (130-200 CZK)">Premium (130â€“200 KÄ)</option>
          <option value="specialty (200+ CZK)">Specialty (200+ KÄ)</option>
        </select>
      </div>
    </div>

    <!-- Tag groups -->
    <div style="margin-bottom:1.25rem">
      <label style="display:block;margin-bottom:.75rem">ChuÅ¥ovÃ© preference</label>

      <div class="tag-group">
        <div class="tag-group-label">â˜• ZÃ¡kladnÃ­ chuÅ¥ovÃ© profily</div>
        <div class="tags-row">
          <button class="tag-btn" onclick="toggleTag(this)">ğŸ¬ SladkÃ½</button>
          <button class="tag-btn" onclick="toggleTag(this)">ğŸ‹ KyselÃ½</button>
          <button class="tag-btn" onclick="toggleTag(this)">ğŸ« HoÅ™kÃ½</button>
          <button class="tag-btn" onclick="toggleTag(this)">ğŸ¥› KrÃ©movÃ½</button>
          <button class="tag-btn" onclick="toggleTag(this)">ğŸŒ¶ KoÅ™enÄ›nÃ½</button>
          <button class="tag-btn" onclick="toggleTag(this)">ğŸŒ¿ BylinnÃ½</button>
          <button class="tag-btn" onclick="toggleTag(this)">ğŸ“ OvocnÃ½</button>
          <button class="tag-btn" onclick="toggleTag(this)">ğŸŒ° OÅ™Ã­Å¡kovÃ½</button>
          <button class="tag-btn" onclick="toggleTag(this)">ğŸŒ¸ KvÄ›tinovÃ½</button>
          <button class="tag-btn" onclick="toggleTag(this)">ğŸµ ZemitÃ½</button>
        </div>
      </div>

      <div class="tag-group">
        <div class="tag-group-label">ğŸ¥ƒ S alkoholem</div>
        <div class="tags-row">
          <button class="tag-btn alc" onclick="toggleTag(this)">ğŸ¥ƒ Whisky / Bourbon</button>
          <button class="tag-btn alc" onclick="toggleTag(this)">ğŸ¸ Amaretto</button>
          <button class="tag-btn alc" onclick="toggleTag(this)">ğŸ¹ Baileys / Irish Cream</button>
          <button class="tag-btn alc" onclick="toggleTag(this)">â˜• KahlÃºa / Coffee Liqueur</button>
          <button class="tag-btn alc" onclick="toggleTag(this)">ğŸ¥‚ Rum</button>
          <button class="tag-btn alc" onclick="toggleTag(this)">ğŸƒ Gin</button>
        <button class="tag-btn alc" onclick="toggleTag(this)">ğŸ«™ Vodka</button>
        </div>
      </div>

      <div class="tag-group" style="margin-bottom:0">
        <div class="tag-group-label">ğŸ§’ Pro dÄ›ti (bez kofeinu)</div>
        <div class="tags-row">
          <button class="tag-btn kid" onclick="toggleTag(this)">ğŸ­ HodnÄ› sladkÃ½</button>
          <button class="tag-btn kid" onclick="toggleTag(this)">ğŸ« ÄŒokolÃ¡dovÃ½</button>
          <button class="tag-btn kid" onclick="toggleTag(this)">ğŸ“ JahodovÃ½</button>
          <button class="tag-btn kid" onclick="toggleTag(this)">ğŸ¦ VanilkovÃ½</button>
          <button class="tag-btn kid" onclick="toggleTag(this)">ğŸ« LesnÃ­ ovoce</button>
          <button class="tag-btn kid" onclick="toggleTag(this)">ğŸª SuÅ¡enkovÃ½ / KaramelovÃ½</button>
        </div>
      </div>
    </div>

    <div class="form-group" style="margin-bottom:0">
      <label>Alergeny / OmezenÃ­ <span style="font-weight:400;text-transform:none;letter-spacing:0;font-family:'DM Sans',sans-serif;font-size:.75rem;color:rgba(122,92,58,.55)">(volitelnÃ©)</span></label>
      <input type="text" id="restrictions" placeholder="NapÅ™: bez laktÃ³zy, vegan, bez lepku...">
    </div>

    <button class="generate-btn" onclick="generateRecipe()">âœ¨ Vygenerovat recept od AI barisky</button>
  </div>

  <!-- â”€â”€ Loading â”€â”€ -->
  <div class="loading-section" id="loadingSection">
    <div class="bubbles">
      <div class="bubble"></div><div class="bubble"></div><div class="bubble"></div>
      <div class="bubble"></div><div class="bubble"></div><div class="bubble"></div>
    </div>
    <p class="loading-text">TvÅ¯j barista pÅ™ipravuje recept...</p>
    <p class="loading-sub" id="loadingStatus">Navrhuje recept</p>
  </div>

  <!-- â”€â”€ Result â”€â”€ -->
  <div class="result-section" id="resultSection">

    <div class="error-banner" id="errorBanner"></div>

    <div class="drink-hero">
      <div>
        <div class="drink-title" id="drinkName">â€”</div>
        <div class="drink-subtitle" id="drinkDesc">â€”</div>
        <div class="drink-badge" id="drinkBadge">AI Recept</div>
      </div>

    </div>

    <div class="cards-grid">

      <div class="info-card">
        <div class="card-label">ğŸ“‹ Postup pÅ™Ã­pravy</div>
        <ol class="step-list" id="stepList"></ol>
      </div>

      <div class="info-card">
        <div class="card-label">ğŸ§ª Ingredience <span style="font-size:.68rem;color:var(--muted);font-weight:400;text-transform:none;letter-spacing:0;font-family:'DM Sans',sans-serif;margin-left:.2rem">(upravitelnÃ©)</span></div>
        <table class="ing-table" id="ingTable">
          <thead><tr>
            <th>Surovina</th>
            <th class="r" style="width:88px">MnoÅ¾stvÃ­</th>
            <th class="r" style="width:72px">KÄ</th>
            <th style="width:26px"></th>
          </tr></thead>
          <tbody id="ingTbody"></tbody>
        </table>
        <button class="add-btn" onclick="addRow()">+ PÅ™idat ingredienci</button>

        <div class="cost-sep"></div>
        <div class="cost-line sub"><span class="cost-lbl">Suroviny celkem</span><span class="cost-val" id="ingTotal">â€”</span></div>
        <div class="cost-line" style="background:rgba(200,130,42,.03)"><span class="cost-lbl">PrÃ¡ce &amp; energie</span><span class="cost-val sm" id="laborVal">â€”</span></div>
        <div class="cost-line tot"><span class="cost-lbl">Celkem / porci</span><span class="cost-val" id="grandVal">â€”</span></div>

        <div class="labor-note">
          <strong>Z Äeho vychÃ¡zÃ­ kalkulace prÃ¡ce a energie:</strong><br>
          HrubÃ¡ mzda baristy v ÄŒR 28â€“35 tis. KÄ/mÄ›s. PÅ™i 8h smÄ›nÄ› a ~60 nÃ¡pojÃ­ch/hod vychÃ¡zÃ­ mzda na <strong>5â€“8 KÄ/Å¡Ã¡lek</strong>. Energie (stroj ~1,5 kW, mlÃ½nek, chlazenÃ­, osvÄ›tlenÃ­) pÅ™idÃ¡vÃ¡ <strong>2â€“4 KÄ</strong>. ÄŒisticÃ­ prostÅ™edky a opotÅ™ebenÃ­ ~2 KÄ. Kalkulace odpovÃ­dÃ¡ prÅ¯mÄ›rnÃ© ÄeskÃ© kavÃ¡rnÄ›.
          <div class="labor-tags">
            <span class="labor-tag">ğŸ‘¤ Mzda: ~6 KÄ</span>
            <span class="labor-tag">âš¡ Energie: ~3 KÄ</span>
            <span class="labor-tag">ğŸ§¹ Provoz: ~2 KÄ</span>
          </div>
        </div>
        <div class="src-note" id="srcNote"></div>
      </div>

      <div class="info-card highlight">
        <div class="card-label">ğŸ“ˆ ProdejnÃ­ cena &amp; marÅ¾e</div>
        <div class="price-row">
          <span class="price-lbl">CelkovÃ© nÃ¡klady / porci</span>
          <span class="price-val" id="priceCost">â€”</span>
        </div>
        <div class="price-row">
          <span class="price-lbl">DoporuÄenÃ¡ prodejnÃ­ cena</span>
          <span class="price-val big" id="priceSell">â€”</span>
        </div>
        <div class="price-row">
          <span class="price-lbl">HrubÃ¡ marÅ¾e</span>
          <div class="m-dual"><span class="m-czk" id="mCZK">â€”</span><span class="m-pct" id="mPCT">â€”</span></div>
        </div>
        <div class="m-bar"><div class="m-fill" id="mFill"></div></div>
        <div class="m-scale"><span>0%</span><span id="mLbl">â€”</span><span>100%</span></div>

        <div class="slider-box">
          <div class="slider-hd">
            <span class="slider-lbl">ğŸš Upravit cÃ­lovou marÅ¾i</span>
            <span class="slider-val" id="sliderPct">70%</span>
          </div>
          <input type="range" id="marginSlider" min="30" max="90" value="70" step="1"
            oninput="onSlider(this.value)" style="--p:70%">
          <div class="slider-scale"><span>30%</span><span>50%</span><span>70%</span><span>90%</span></div>
          <div class="slider-result">
            <span class="slider-result-lbl">ProdejnÃ­ cena pÅ™i zvolenÃ© marÅ¾i</span>
            <span class="slider-result-price" id="sliderPrice">â€”</span>
          </div>
        </div>
      </div>

      <div class="info-card full market-card">
        <div class="market-lbl">ğŸ” PodobnÃ© nÃ¡poje na trhu</div>
        <div id="marketResults"><div style="color:rgba(232,213,188,.35);font-style:italic;font-size:.9rem">NaÄÃ­tÃ¡m data...</div></div>
        <div class="market-disc">â„¹ï¸ Data sestavena AI z veÅ™ejnÃ½ch zdrojÅ¯. Ceny jsou orientaÄnÃ­ a slouÅ¾Ã­ jako prÅ¯zkum trhu.</div>
      </div>

      <div class="info-card full">
        <div class="card-label">ğŸ‘¨â€ğŸ³ Tip od AI barisky</div>
        <p style="font-size:.95rem;line-height:1.75;color:var(--text)" id="baristaTip">â€”</p>
      </div>
    </div>

    <button class="reset-btn" onclick="resetForm()">â†© VytvoÅ™it novÃ½ recept</button>
  </div>
</main>

<script>
// â”€â”€ Beans â”€â”€
(function(){
  const wrap = document.getElementById('beans');
  const colors = ['#3b1a08','#5c3520','#7a4828','#a06040','#2c1a0e','#6b3a1f'];

  function lighten(hex){
    const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);
    return '#'+[r+45,g+28,b+16].map(v=>Math.min(255,v).toString(16).padStart(2,'0')).join('');
  }
  function darken(hex){
    const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);
    return '#'+[r-20,g-12,b-8].map(v=>Math.max(0,v).toString(16).padStart(2,'0')).join('');
  }

  function makeBeanSVG(sz, color, uid){
    const lg = lighten(color), dk = darken(color);
    return `<svg width="${sz}" height="${Math.round(sz*1.45)}" viewBox="0 0 40 58" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <radialGradient id="bg${uid}" cx="36%" cy="32%" r="62%">
          <stop offset="0%" stop-color="${lg}"/>
          <stop offset="100%" stop-color="${color}"/>
        </radialGradient>
      </defs>
      <ellipse cx="20" cy="29" rx="17.5" ry="25" fill="url(#bg${uid})"/>
      <path d="M20 5 Q13 19 13 29 Q13 39 20 53"
        stroke="${dk}" stroke-width="2.4" fill="none" stroke-linecap="round" opacity=".65"/>
      <ellipse cx="12" cy="17" rx="5" ry="7" fill="white" opacity=".09" transform="rotate(-18 12 17)"/>
    </svg>`;
  }

  // Inject keyframe animations once
  const style = document.createElement('style');
  style.textContent = `
    @keyframes beanFloat0{
      0%  {transform:translateY(108vh) rotate(0deg);  opacity:0}
      6%  {opacity:.55}
      94% {opacity:.22}
      100%{transform:translateY(-14vh) rotate(200deg);opacity:0}
    }
    @keyframes beanFloat1{
      0%  {transform:translateY(108vh) translateX(0)   rotate(0deg);  opacity:0}
      6%  {opacity:.5}
      45% {transform:translateY(55vh)  translateX(35px) rotate(95deg);opacity:.4}
      94% {opacity:.18}
      100%{transform:translateY(-14vh) translateX(-25px) rotate(230deg);opacity:0}
    }
  `;
  document.head.appendChild(style);

  for(let i=0;i<14;i++){
    const div   = document.createElement('div');
    div.className = 'bean';
    const sz    = 16 + Math.random() * 20;
    const color = colors[i % colors.length];
    const rot   = Math.floor(Math.random() * 360);
    const dur   = 20 + Math.random() * 18;
    const delay = Math.random() * 22;
    const left  = Math.random() * 100;
    div.style.cssText = `left:${left}%;opacity:0;animation:beanFloat${i%2} ${dur}s ${delay}s linear infinite;transform:rotate(${rot}deg);`;
    div.innerHTML = makeBeanSVG(sz, color, i);
    wrap.appendChild(div);
  }
})();

function toggleTag(btn){btn.classList.toggle('active');}
function getTags(){return[...document.querySelectorAll('.tag-btn.active')].map(b=>b.textContent.trim());}

// â”€â”€ Proxy URL (Vercel serverless function) â”€â”€
// The API key lives in Vercel environment variables â€” never in this file.
const PROXY_URL = '/api/claude';

// â”€â”€ State â”€â”€
let _labor=0, _marginPct=70, _ingredients=[];
let _loadInt;
const _msgs=['Navrhuje recept...','LadÃ­ pomÄ›ry...','PoÄÃ­tÃ¡ nÃ¡klady...','ProhledÃ¡vÃ¡ trh...','Finalizuje...'];

// â”€â”€ Generate â”€â”€
async function generateRecipe(){
  const concept   = document.getElementById('concept').value.trim();
  const base      = document.getElementById('coffeeBase').value;
  const drinkType = document.getElementById('drinkType').value;
  const portion   = document.getElementById('portionSize').value;
  const price     = document.getElementById('priceRange').value;
  const restrict  = document.getElementById('restrictions').value.trim();
  const tags      = getTags();

  document.getElementById('inputSection').style.display='none';
  document.getElementById('resultSection').style.display='none';
  document.getElementById('loadingSection').style.display='block';
  document.getElementById('errorBanner').style.display='none';

  let mi=0;
  _loadInt=setInterval(()=>{document.getElementById('loadingStatus').textContent=_msgs[mi++%_msgs.length];},1800);

  const isKids   = base==='kids';
  const alcTags  = ['Whisky','Bourbon','Amaretto','Baileys','Irish Cream','KahlÃºa','Coffee Liqueur','Rum','Gin','Vodka'];
  const isAlcohol= !isKids && tags.some(t=>alcTags.some(a=>t.includes(a)));

  const prompt=`Jsi expert barista, food business konzultant a market researcher. VytvoÅ™ kompletnÃ­ analÃ½zu ${isKids?'dÄ›tskÃ©ho nÃ¡poje (BEZ KÃVY, BEZ KOFEINU â€” pouÅ¾ij vÃ½hradnÄ› nÃ¡hraÅ¾ku jako Caro, ÄekankovÃ¡ kÃ¡va, jeÄmen, karob)':'kÃ¡vovÃ©ho nÃ¡poje'} pro kavÃ¡rnu v ÄŒR.

${concept?`UpÅ™esnÄ›nÃ­: "${concept}"`:'Bez upÅ™esnÄ›nÃ­ â€” navrhni kreativnÃ­ recept dle ostatnÃ­ch parametrÅ¯.'}
ZÃ¡klad: ${isKids?'nÃ¡hraÅ¾ka kÃ¡vy (Caro / Äekanka / jeÄmen)':base} | Typ: ${drinkType} | Porce: ${portion}
CenovÃ¡ kategorie: ${price}
ChuÅ¥: ${tags.filter(t=>!alcTags.some(a=>t.includes(a))).join(', ')||'libovolnÃ¡'}
OmezenÃ­: ${restrict||'Å¾Ã¡dnÃ©'}
${isKids?'KLÃÄŒOVÃ‰: dÄ›tskÃ¡ varianta â€” Å¾Ã¡dnÃ¡ kÃ¡va, Å¾Ã¡dnÃ½ kofein, Å¾Ã¡dnÃ½ alkohol. Badge = "Kids Drink".':''}
${isAlcohol?`KLÃÄŒOVÃ‰: recept obsahuje alkohol (${tags.filter(t=>alcTags.some(a=>t.includes(a))).join(', ')}) â€” uveÄ pÅ™esnÃ© mnoÅ¾stvÃ­, ceny lihovin z ÄŒR velkoobchodu. Badge = "Cocktail Coffee".`:''}

VraÅ¥ POUZE ÄistÃ½ JSON bez markdown:
{
  "name":"OriginÃ¡lnÃ­ nÃ¡zev",
  "subtitle":"PoutavÃ½ popis 1-2 vÄ›ty",
  "badge":"Signature",
  "drinkStyle":"latte|iced_latte|frappÃ©|cappuccino|flat_white|cold_brew|other",
  "colorScheme":{"liquid":"#hex","foam":"#hex","layer2":"#hex","accent":"#hex","cup":"#hex","garnish":"#hex"},
  "ingredients":[{"name":"NÃ¡zev","amount":"60 ml","costPerPortion":9.0}],
  "steps":["Krok 1","Krok 2","Krok 3","Krok 4","Krok 5"],
  "totalIngredientCost":24.0,
  "laborAndEnergyCost":11.0,
  "recommendedSellPrice":129,
  "grossMarginCZK":94.0,
  "marginPercent":73,
  "baristaTip":"Tip na pÅ™Ã­pravu nebo marketing.",
  "priceSourceNote":"Ceny surovin: orientaÄnÃ­ velkoobchodnÃ­ prÅ¯mÄ›ry ÄŒR (Makro, Metro, Bidvest).",
  "market":{
    "found":true,
    "results":[{"cafe":"KavÃ¡rna","location":"MÄ›sto, ZemÄ›","drinkName":"NÃ¡poj","price":"119 KÄ","note":"PoznÃ¡mka"}],
    "marketInsight":"1-2 vÄ›ty o trhu a cenÃ¡ch."
  }
}
PovinnÄ›: ingredients pouÅ¾Ã­vajÃ­ klÃ­Ä "costPerPortion". market.results = 3-5 reÃ¡lnÃ½ch kavÃ¡ren. PÅ™epoÄet: 1EUR=25KÄ, 1USD=23KÄ.`;

  try{
    const res=await fetch(PROXY_URL,{
      method:'POST',
      headers:{
        'Content-Type':'application/json',
      },
      body:JSON.stringify({
        model:'claude-sonnet-4-20250514',
        max_tokens:2500,
        messages:[{role:'user',content:prompt}]
      })
    });

    if(!res.ok){
      const err=await res.json().catch(()=>({error:{message:'HTTP '+res.status}}));
      throw new Error(err?.error?.message||'HTTP '+res.status);
    }

    const data=await res.json();

    // Check for API-level error
    if(data.type==='error'){
      throw new Error(data.error?.message||'API error');
    }

    const text=data.content.map(b=>b.type==='text'?b.text:'').join('');
    if(!text) throw new Error('PrÃ¡zdnÃ¡ odpovÄ›Ä od AI');

    const clean=text.replace(/```json|```/g,'').trim();
    const recipe=JSON.parse(clean);
    clearInterval(_loadInt);
    renderRecipe(recipe);

  }catch(err){
    clearInterval(_loadInt);
    console.error('API error:',err);
    // Show error + fall back to demo
    document.getElementById('loadingSection').style.display='none';
    const eb=document.getElementById('errorBanner');
    eb.textContent='âš ï¸ '+err.message+' â€” zobrazuji ukÃ¡zkovÃ½ recept.';
    eb.style.display='block';
    renderRecipe(getDemo());
  }
}


// â”€â”€ Editable ingredients â”€â”€
function renderIngTable(ings){
  _ingredients=ings.map(i=>({name:i.name,amount:i.amount||'',cost:parseFloat(i.costPerPortion||i.totalCost||0)}));
  redrawTable();
}

function redrawTable(){
  const tb=document.getElementById('ingTbody');
  tb.innerHTML='';
  _ingredients.forEach((ing,i)=>{
    const tr=document.createElement('tr');
    tr.style.animation=`slideIn .3s ease ${i*.06}s both`;
    tr.innerHTML=`
      <td><input class="ing-input" value="${esc(ing.name)}" placeholder="NÃ¡zev" onchange="upd(${i},'name',this.value)"></td>
      <td><input class="ing-input amt" value="${esc(ing.amount)}" placeholder="60 ml" onchange="upd(${i},'amount',this.value)"></td>
      <td><input class="ing-input cst" type="number" step="0.5" min="0" value="${ing.cost.toFixed(1)}" oninput="upd(${i},'cost',this.value)"></td>
      <td><button class="del-btn" onclick="delRow(${i})">Ã—</button></td>`;
    tb.appendChild(tr);
  });
  recalc();
}
function upd(i,f,v){_ingredients[i][f]=f==='cost'?parseFloat(v)||0:v;recalc();}
function delRow(i){_ingredients.splice(i,1);redrawTable();}
function addRow(){
  _ingredients.push({name:'',amount:'',cost:0});
  redrawTable();
  setTimeout(()=>{const r=document.querySelectorAll('#ingTbody .ing-input');if(r.length)r[r.length-3].focus();},40);
}

function recalc(){
  const sum=_ingredients.reduce((s,i)=>s+i.cost,0);
  const tot=sum+_labor;
  document.getElementById('ingTotal').textContent=czk(sum);
  document.getElementById('laborVal').textContent=czk(_labor);
  document.getElementById('grandVal').textContent=czk(tot);
  document.getElementById('priceCost').textContent=czk(tot);
  const sell=tot/(1-_marginPct/100);
  const mczk=sell-tot;
  document.getElementById('priceSell').textContent=czk(Math.round(sell));
  document.getElementById('mCZK').textContent=czk(Math.round(mczk));
  document.getElementById('mPCT').textContent=_marginPct+'%';
  document.getElementById('mLbl').textContent=_marginPct+'%';
  document.getElementById('mFill').style.width=_marginPct+'%';
  document.getElementById('sliderPrice').textContent=czk(Math.round(sell));
}

// â”€â”€ Slider â”€â”€
function onSlider(v){
  _marginPct=parseInt(v);
  document.getElementById('sliderPct').textContent=_marginPct+'%';
  document.getElementById('marginSlider').style.setProperty('--p',_marginPct+'%');
  recalc();
}

// â”€â”€ Render recipe â”€â”€
function renderRecipe(r){
  document.getElementById('loadingSection').style.display='none';
  document.getElementById('drinkName').textContent=r.name||'NÃ¡poj';
  document.getElementById('drinkDesc').textContent=r.subtitle||'';
  document.getElementById('drinkBadge').textContent=r.badge||'AI Recept';



  // Steps
  const sl=document.getElementById('stepList');sl.innerHTML='';
  (r.steps||[]).forEach((s,i)=>{
    const li=document.createElement('li');li.className='step-item';li.style.animationDelay=(i*.1)+'s';
    li.innerHTML=`<div class="step-num c${i%6}">${i+1}</div><div class="step-text">${esc(s)}</div>`;
    sl.appendChild(li);
  });

  // Ingredients
  _labor=r.laborAndEnergyCost||11;
  _marginPct=r.marginPercent||70;
  renderIngTable(r.ingredients||[]);
  document.getElementById('srcNote').textContent=r.priceSourceNote||'';

  // Slider initial
  const sl2=document.getElementById('marginSlider');
  sl2.value=_marginPct;
  sl2.style.setProperty('--p',_marginPct+'%');
  document.getElementById('sliderPct').textContent=_marginPct+'%';

  // Animate margin bar
  document.getElementById('mFill').style.width='0%';
  setTimeout(()=>document.getElementById('mFill').style.width=_marginPct+'%',350);

  document.getElementById('baristaTip').textContent=r.baristaTip||'';
  renderMarket(r.market);
  document.getElementById('resultSection').style.display='block';
  window.scrollTo({top:0,behavior:'smooth'});
}

// â”€â”€ Market â”€â”€
function renderMarket(m){
  const el=document.getElementById('marketResults');
  if(!m||!m.found||!(m.results||[]).length){
    el.innerHTML=`<div class="market-none">KavÃ¡rny s identickÃ½m nÃ¡pojem nebyly nalezeny â€” vaÅ¡e vÃ½hoda! ğŸš€</div>
    ${m?.marketInsight?`<div class="market-insight"><div class="market-insight-lbl">ğŸ’¡ TrÅ¾nÃ­ kontext</div><div class="market-insight-txt">${m.marketInsight}</div></div>`:''}`;
    return;
  }
  let h=m.results.map((r,i)=>`
    <div class="market-item" style="animation-delay:${i*.1}s">
      <div class="market-name">${esc(r.drinkName)}</div>
      <div class="market-meta"><span class="market-loc">ğŸ“ ${esc(r.cafe)} Â· ${esc(r.location)}</span><span class="market-price">${esc(r.price)}</span></div>
      ${r.note?`<div class="market-note">${esc(r.note)}</div>`:''}
    </div>`).join('');
  if(m.marketInsight) h+=`<div class="market-insight"><div class="market-insight-lbl">ğŸ’¡ TrÅ¾nÃ­ pÅ™ehled</div><div class="market-insight-txt">${m.marketInsight}</div></div>`;
  el.innerHTML=h;
}

// â”€â”€ Helpers â”€â”€
function czk(v){return Math.round(+v).toLocaleString('cs-CZ')+'\u00a0KÄ';}
function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}

// â”€â”€ Demo â”€â”€
function getDemo(){
  return{
    name:'ZlatÃ½ ZÃ¡pad',subtitle:'Espresso s karamelizovanÃ½m medem, skoÅ™icÃ­ a oÅ™Ã­Å¡kovÃ½m mlÃ©kem â€” jako zÃ¡pad slunce v Å¡Ã¡lku.',
    badge:'Signature',drinkStyle:'latte',
    colorScheme:{liquid:'#c8822a',foam:'#f5ede0',layer2:'#5a2d00',accent:'#d4a843',cup:'#f0e6d3',garnish:'#5c3a1e'},
    ingredients:[
      {name:'Espresso doppio',amount:'60 ml',costPerPortion:9},
      {name:'OÅ™Ã­Å¡kovÃ© mlÃ©ko Oatly Barista',amount:'180 ml',costPerPortion:7},
      {name:'KaramelizovanÃ½ med',amount:'15 ml',costPerPortion:4},
      {name:'SkoÅ™icovÃ½ sirup',amount:'10 ml',costPerPortion:3},
      {name:'MoÅ™skÃ¡ sÅ¯l Å¡petka',amount:'0.5 g',costPerPortion:0.5}
    ],
    steps:[
      'PÅ™ipravte doppio espresso do pÅ™edehÅ™Ã¡tÃ©ho Å¡Ã¡lku.',
      'Med zahÅ™ejte 30 s do lehkÃ© karamelizace, pÅ™idejte skoÅ™icovÃ½ sirup.',
      'OÅ™Ã­Å¡kovÃ© mlÃ©ko napÄ›Åˆte na 65 Â°C â€” jemnÃ¡ hedvÃ¡bnÃ¡ pÄ›na.',
      'VmÃ­chejte medovo-skoÅ™icovou smÄ›s do espresso.',
      'Nalijte napÄ›nÄ›nÃ© mlÃ©ko, ozdobte skoÅ™icÃ­ a moÅ™skou solÃ­.'
    ],
    totalIngredientCost:23.5,laborAndEnergyCost:11,recommendedSellPrice:119,
    grossMarginCZK:84.5,marginPercent:71,
    baristaTip:'Karamelizaci medu pÅ™ipravujte ÄerstvÄ› pro kaÅ¾dÃ½ Å¡Ã¡lek â€” zÃ¡kaznÃ­kÅ¯m to Å™Ã­kejte, je to vÃ¡Å¡ nejsilnÄ›jÅ¡Ã­ prodejnÃ­ argument!',
    priceSourceNote:'Ceny surovin: orientaÄnÃ­ prÅ¯mÄ›ry z velkoobchodÅ¯ ÄŒR (Makro, Metro).',
    market:{found:true,results:[
      {cafe:'Starbucks',location:'Praha, ÄŒR',drinkName:'Honey Oat Milk Latte',price:'139 KÄ',note:'SezÃ³nnÃ­, kombinace medu a alternativnÃ­ho mlÃ©ka'},
      {cafe:'Costa Coffee',location:'Brno, ÄŒR',drinkName:'Caramel Oat Latte',price:'129 KÄ',note:'KaramelovÃ¡ varianta s ovesnÃ½m mlÃ©kem'},
      {cafe:'Black Medicine',location:'Edinburgh, UK',drinkName:'Honey Cinnamon Flat White',price:'138 KÄ',note:'Specialty s lokÃ¡lnÃ­m medem'},
      {cafe:'Intelligentsia Coffee',location:'Chicago, USA',drinkName:'Spiced Honey Latte',price:'161 KÄ',note:'PravÃ½ skoÅ™icovÃ½ extrakt'}
    ],marketInsight:'Honey + alt-milk lattes patÅ™Ã­ mezi nejrychleji rostoucÃ­ trendy specialty kÃ¡vy. TypickÃ© ceny v ÄŒR 110â€“160 KÄ, specialty kavÃ¡rny aÅ¾ 180 KÄ.'}
  };
}

function resetForm(){
  document.getElementById('resultSection').style.display='none';
  document.getElementById('inputSection').style.display='block';
  document.getElementById('concept').value='';
  document.querySelectorAll('.tag-btn.active').forEach(b=>b.classList.remove('active'));
  _ingredients=[];_labor=0;_marginPct=70;
  window.scrollTo({top:0,behavior:'smooth'});
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACCESS CODE SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const ACCESS_CODES_KEY = 'bai_access_codes';
const ACCESS_SESSION_KEY = 'bai_access_ok';
const ACCESS_CFG_KEY = 'bai_access_cfg';

function getDefaultCodes(){
  return {
    "DEMO-2024": { uses: 999, used: 0, expires: null, label: "Demo kÃ³d" },
    "CAFE-0001": { uses: 1, used: 0, expires: "2027-12-31", label: "KavÃ¡rna 1" },
    "CAFE-0002": { uses: 1, used: 0, expires: "2027-12-31", label: "KavÃ¡rna 2" },
  };
}

function getAccessCodes(){
  const stored = localStorage.getItem(ACCESS_CODES_KEY);
  if(stored){
    const merged = Object.assign({}, getDefaultCodes(), JSON.parse(stored));
    return merged;
  }
  return getDefaultCodes();
}

function saveAccessCodes(codes){
  localStorage.setItem(ACCESS_CODES_KEY, JSON.stringify(codes));
}

function getAccessCfg(){
  return JSON.parse(localStorage.getItem(ACCESS_CFG_KEY) || '{}');
}

function applyGateCfg(){
  const cfg = getAccessCfg();
  if(cfg.gateDesc) document.getElementById('gateDesc').innerHTML = cfg.gateDesc;
  if(cfg.contact) document.getElementById('gateContactLink').href = 'mailto:'+cfg.contact;
  if(cfg.gateFooterNote) document.getElementById('gateFooterNote').textContent = cfg.gateFooterNote;
}

function formatGateCode(inp){
  let v = inp.value.replace(/[^A-Za-z0-9]/g,'').toUpperCase();
  if(v.length > 4) v = v.slice(0,4) + '-' + v.slice(4,8);
  inp.value = v;
}

function checkAccessCode(){
  const raw = document.getElementById('gateCodeInput').value.trim().toUpperCase();
  const inp = document.getElementById('gateCodeInput');
  const errEl = document.getElementById('gateErr');
  const defaults = getDefaultCodes();
  const stored = JSON.parse(localStorage.getItem(ACCESS_CODES_KEY) || '{}');
  const codes = Object.assign({}, defaults, stored);
  const code = codes[raw];

  errEl.textContent = '';

  if(!code){
    showGateError(inp, errEl, 'KÃ³d nebyl nalezen. Zkontrolujte zadÃ¡nÃ­.');
    return;
  }
  if(code.expires && new Date(code.expires) < new Date()){
    showGateError(inp, errEl, 'Platnost kÃ³du vyprÅ¡ela. Kontaktujte nÃ¡s pro obnovu.');
    return;
  }
  if(code.uses > 0 && code.used >= code.uses){
    showGateError(inp, errEl, 'Tento kÃ³d byl jiÅ¾ pouÅ¾it. Kontaktujte nÃ¡s.');
    return;
  }

  code.used = (code.used || 0) + 1;
  saveAccessCodes(codes);

  const expiry = Date.now() + 30 * 24 * 60 * 60 * 1000;
  localStorage.setItem(ACCESS_SESSION_KEY, JSON.stringify({ code: raw, expiry }));

  const gate = document.getElementById('accessGate');
  gate.style.transition = 'opacity .4s ease';
  gate.style.opacity = '0';
  setTimeout(()=> gate.style.display = 'none', 420);
}

function showGateError(inp, errEl, msg){
  errEl.textContent = msg;
  inp.classList.add('error');
  setTimeout(()=> inp.classList.remove('error'), 400);
}

function checkExistingSession(){
  try{
    const s = JSON.parse(localStorage.getItem(ACCESS_SESSION_KEY) || 'null');
    if(s && s.expiry > Date.now()){
      document.getElementById('accessGate').style.display = 'none';
    }
  } catch(e){}
}

applyGateCfg();
checkExistingSession();

</script>
</body>
</html>
